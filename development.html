

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DEVELOPPEMENT &mdash; GeoNature 2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="COMPATIBILITE" href="versions-compatibility.html" />
    <link rel="prev" title="IMPORT NIVEAU 2" href="import-level-2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="index.html" class="icon icon-home"> GeoNature
          

          
            
            <img src="_static/LogoGeonature.jpg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation-all.html">INSTALLATION GLOBALE</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation-standalone.html">INSTALLATION AUTONOME</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation-mtes.html">SPECIFICITES DEPOBIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">MANUEL UTILISATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin-manual.html">MANUEL ADMINISTRATEUR</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-1.html">IMPORT NIVEAU 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="import-level-2.html">IMPORT NIVEAU 2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DEVELOPPEMENT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general">Général</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#release">Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bdd">BDD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pratiques">Pratiques</a></li>
<li class="toctree-l2"><a class="reference internal" href="#developper-et-installer-un-gn-module">Développer et installer un gn_module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#developper-un-gn-module">Développer un gn_module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bonnes-pratiques">Bonnes pratiques</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#frontend">Frontend</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backend">Backend</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installer-un-gn-module">Installer un gn_module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#developpement-backend">Développement Backend</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#demarrage-du-serveur-de-dev-backend">Démarrage du serveur de dev backend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#base-de-donnees">Base de données</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#session-sqlalchemy">Session sqlalchemy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#serialisation-des-modeles">Serialisation des modèles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export-des-donnees">Export des données</a></li>
<li class="toctree-l3"><a class="reference internal" href="#utilisation-de-la-configuration">Utilisation de la configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#authentification-avec-pypnusershub">Authentification avec pypnusershub</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#verification-des-droits-des-utilisateurs">Vérification des droits des utilisateurs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#documentation-api-backend">Documentation API Backend</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#liste-des-routes">Liste des routes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentation-des-routes">Documentation des routes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#developpement-frontend">Développement Frontend</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modules">Modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#les-composants-generiques"><strong>Les composants génériques</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#outils-d-aide-a-la-qualite-du-code">Outils d’aide à la qualité du code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installation-des-outils">Installation des outils</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sphinx">Sphinx</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flake8">Flake8</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pylint">Pylint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tslint">tslint</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mypy">Mypy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pytest">Pytest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#coverage">Coverage</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="versions-compatibility.html">COMPATIBILITE</a></li>
<li class="toctree-l1"><a class="reference internal" href="conf-apache.html">CONFIGURATION APACHE</a></li>
<li class="toctree-l1"><a class="reference internal" href="https.html">HTTPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">AUTEURS</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">CHANGELOG</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GeoNature</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>DEVELOPPEMENT</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/development.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="developpement">
<h1>DEVELOPPEMENT<a class="headerlink" href="#developpement" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general">
<h2>Général<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p>GeoNature a été développé par Gil Deluermoz depuis 2010 avec PHP/Symfony/ExtJS.</p>
<p>En 2017, les parcs nationaux français ont décidé de refondre GeoNature complètement avec une nouvelle version (V2) réalisée en Python/Flask/Angular 4.</p>
<p>Mainteneurs :</p>
<ul class="simple">
<li>Gil DELUERMOZ (PnEcrins) : Base de données / SQL / Installation / Mise à jour</li>
<li>Amandine SAHL (PnCevennes) : Backend / Python Flask / API</li>
<li>Theo LECHEMIA (PnEcrins) : Frontend / Angular 4</li>
<li>Camille MONCHICOURT (PnEcrins) : Documentation / Gestion du projet</li>
</ul>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>GeoNature utilise :</p>
<ul class="simple">
<li>l’API de TaxHub (recherche taxon, règne et groupe d’un taxon…)</li>
<li>l’API du sous-module Nomenclatures (typologies et listes déroulantes)</li>
<li>l’API du sous-module d’authentification de UsersHub (login/logout, récupération du CRUVED d’un utilisateur)</li>
<li>l’API de GeoNature (get, post, update des données des différents modules, métadonnées, intersections géographiques, exports…)</li>
</ul>
<p>Pour avoir des infos et la documentation de ces API, on utilise PostMan. Documentation API : <a class="reference external" href="https://documenter.getpostman.com/view/2640883/RWaPskTw">https://documenter.getpostman.com/view/2640883/RWaPskTw</a></p>
<img alt="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/api_services.png" src="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/api_services.png" />
<p><em>&#64;TODO : Doc API à mettre à jour</em></p>
</div>
<div class="section" id="release">
<h2>Release<a class="headerlink" href="#release" title="Permalink to this headline">¶</a></h2>
<p>Pour sortir une nouvelle version de GeoNature :</p>
<ul class="simple">
<li>Faites les éventuelles Releases des dépendances (UsersHub, TaxHub, UsersHub-authentification-module, Nomenclature-api-module, GeoNature-atlas)</li>
<li>Mettez à jour la version de GeoNature et éventuellement des dépendances dans <code class="docutils literal"><span class="pre">install/install_all/install_all.ini</span></code>, <code class="docutils literal"><span class="pre">config/settings.ini.sample</span></code>, <code class="docutils literal"><span class="pre">backend/requirements.txt</span></code></li>
<li>Compléter le fichier <code class="docutils literal"><span class="pre">docs/CHANGELOG.rst</span></code> (en comparant les branches <a class="reference external" href="https://github.com/PnX-SI/GeoNature/compare/develop">https://github.com/PnX-SI/GeoNature/compare/develop</a>) et dater la version à sortir</li>
<li>Mettez à jour le fichier <code class="docutils literal"><span class="pre">VERSION</span></code></li>
<li>Remplir le tableau de compatibilité des dépendances (<code class="docutils literal"><span class="pre">docs/versions-compatibility.rst</span></code>)</li>
<li>Mergez la branche <code class="docutils literal"><span class="pre">develop</span></code> dans la branche <code class="docutils literal"><span class="pre">master</span></code></li>
<li>Faites la release (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/releases">https://github.com/PnX-SI/GeoNature/releases</a>) en la taguant <code class="docutils literal"><span class="pre">X.Y.Z</span></code> (sans <code class="docutils literal"><span class="pre">v</span></code> devant) et en copiant le contenu du Changelog</li>
<li>Dans la branche <code class="docutils literal"><span class="pre">develop</span></code>, modifiez le fichier <code class="docutils literal"><span class="pre">VERSION</span></code> en <code class="docutils literal"><span class="pre">X.Y.Z.dev0</span></code> et pareil dans le fichier <code class="docutils literal"><span class="pre">docs/CHANGELOG.rst</span></code></li>
</ul>
</div>
<div class="section" id="bdd">
<h2>BDD<a class="headerlink" href="#bdd" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Mettre à jour le <code class="docutils literal"><span class="pre">ref_geo</span></code> à partir des données IGN scan express :<ul>
<li>Télécharger le dernier millesime: <a class="reference external" href="http://professionnels.ign.fr/adminexpress">http://professionnels.ign.fr/adminexpress</a></li>
<li>Intégrer le fichier Shape dans la BDD grâce à QGIS dans une table nommée <code class="docutils literal"><span class="pre">ref_geo.temp_fr_municipalities</span></code></li>
<li>Générer le SQL de création de la table : <code class="docutils literal"><span class="pre">pg_dump</span> <span class="pre">--table=ref_geo.temp_fr_municipalities</span> <span class="pre">--column-inserts</span> <span class="pre">-U</span> <span class="pre">&lt;MON_USER&gt;</span> <span class="pre">-h</span> <span class="pre">&lt;MON_HOST&gt;</span> <span class="pre">-d</span> <span class="pre">&lt;MA_BASE&gt;</span> <span class="pre">&gt;</span> <span class="pre">fr_municipalities.sql</span></code>. Le fichier en sortie doit s’appeler <code class="docutils literal"><span class="pre">fr_municipalities.sql</span></code></li>
<li>Zipper le fichier SQL et le mettre sur le serveur <a class="reference external" href="http://geonature.fr/data">http://geonature.fr/data</a></li>
<li>Adapter le script <code class="docutils literal"><span class="pre">install_db.sh</span></code> pour récupérer le nouveau fichier zippé</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="pratiques">
<h2>Pratiques<a class="headerlink" href="#pratiques" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Ne jamais faire de commit dans la branche <code class="docutils literal"><span class="pre">master</span></code> mais dans la branche <code class="docutils literal"><span class="pre">develop</span></code> ou idéalement dans une branche dédiée à la fonctionnalité</li>
<li>Faire des pull request vers la branche <code class="docutils literal"><span class="pre">develop</span></code> regroupant plusieurs commits depuis la branche de sa fonctionnalité pour plus de lisibilité, éviter les conflits et déclencher les tests automatiques Travis avant d’intégrer la branche <code class="docutils literal"><span class="pre">develop</span></code></li>
<li>Faire des <code class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></code> avant chaque développement et avant chaque commit</li>
<li>Les messages de commits font référence à ticket ou le ferme (<code class="docutils literal"><span class="pre">ref</span> <span class="pre">#12</span></code> ou <code class="docutils literal"><span class="pre">fixes</span> <span class="pre">#23</span></code>)</li>
</ul>
</div>
<div class="section" id="developper-et-installer-un-gn-module">
<h2>Développer et installer un gn_module<a class="headerlink" href="#developper-et-installer-un-gn-module" title="Permalink to this headline">¶</a></h2>
<p>GeoNature a été conçu pour fonctionner en briques modulaires.</p>
<p>Chaque protocole, répondant à une question scientifique, est amené à avoir son propre module GeoNature comportant son modèle de base de données (dans un schéma séparé), son API et son interface utilisateur.</p>
<p>Les modules développés s’appuieront sur le coeur de GeoNature qui est constitué d’un ensemble de briques réutilisables.</p>
<p>En base de données, le coeur de GeoNature est constitué de l’ensemble des référentiels (utilisateurs, taxonomique, nomenclatures géographique)
et du schéma <code class="docutils literal"><span class="pre">synthese</span></code> regroupant l’ensemble données saisies dans les différents protocoles (voir doc administrateur pour plus de détail sur le modèle de données).</p>
<p>L’API du coeur permet d’interroger les schémas de la base de données “coeur” de GeoNature. Une documentation complète de l’API est disponible dans la rubrique DEVELOPPEMENT/Documentation API backend</p>
<p>Du côté interface utilisateur, GeoNature met à disposition un ensemble de composants Angular réutilisables (<a class="reference external" href="http://pnx-si.github.io/GeoNature/frontend/modules/GN2CommonModule.html">http://pnx-si.github.io/GeoNature/frontend/modules/GN2CommonModule.html</a>
), pour l’affichage des cartes, des formulaires etc…</p>
<div class="section" id="developper-un-gn-module">
<h3>Développer un gn_module<a class="headerlink" href="#developper-un-gn-module" title="Permalink to this headline">¶</a></h3>
<p>Avant de développer un gn_module, assurez-vous d’avoir GeoNature bien installé sur votre machine (<a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/docs/installation-standalone.rst">voir doc</a>).</p>
<p>Afin de pouvoir connecter ce module au “coeur”, il est impératif de suivre une arborescence prédéfinie par l’équipe GeoNature.
Un temmplate GitHub a été prévu à cet effet (<a class="reference external" href="https://github.com/PnX-SI/gn_module_template">https://github.com/PnX-SI/gn_module_template</a>). Il est possible de créer un nouveau dépôt GitHub à partir de ce template, ou alors de copier/coller le contenu du dépôt dans un nouveau.</p>
<p>Cette arborescence implique de développer le module dans les technologies du coeur de GeoNature à savoir :</p>
<ul class="simple">
<li>Le backend est développé en Python grâce au framework Flask.</li>
<li>Le frontend est développé grâce au framework Angular (voir la version actuelle du coeur)</li>
</ul>
<p>GeoNature prévoit cependant l’intégration de module “externe” dont le frontend serait développé dans d’autres technologies. La gestion de l’intégration du module est à la charge du développeur.</p>
<ul>
<li><p class="first">Le module se placera dans un dossier à part du dossier “GeoNature” et portera le suffixe “gn_module”</p>
<p>Exemple : <em>gn_module_validation</em></p>
</li>
<li><p class="first">La racine du module comportera les fichiers suivants :</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">install_app.sh</span></code> : script bash d’installation des librairies python ou npm necessaires au module</li>
<li><code class="docutils literal"><span class="pre">install_env.sh</span></code> : script bash d’installation des paquets Linux</li>
<li><code class="docutils literal"><span class="pre">requirements.txt</span></code> : liste des librairies python necessaires au module</li>
<li><code class="docutils literal"><span class="pre">manifest.toml</span></code> : fichier de description du module (nom, version du module, version de GeoNature compatible)</li>
<li><code class="docutils literal"><span class="pre">conf_gn_module.toml</span></code> : fichier de configuration de l’application (livré en version sample)</li>
<li><code class="docutils literal"><span class="pre">conf_schema_toml.py</span></code> : schéma ‘marshmallow’ (<a class="reference external" href="https://marshmallow.readthedocs.io/en/latest/">https://marshmallow.readthedocs.io/en/latest/</a>) du fichier de configuration (permet de s’assurer la conformité des paramètres renseignés par l’utilisateur). Ce fichier doit contenir une classe <code class="docutils literal"><span class="pre">GnModuleSchemaConf</span></code> dans laquelle toutes les configurations sont synchronisées.</li>
<li><code class="docutils literal"><span class="pre">install_gn_module.py</span></code> : script python lançant les commandes relatives à l’installation du module (Base de données, …). Ce fichier doit comprendre une fonction <code class="docutils literal"><span class="pre">gnmodule_install_app(gn_db,</span> <span class="pre">gn_app)</span></code> qui est utilisée pour installer le module (Voir l’<a class="reference external" href="https://github.com/PnX-SI/gn_module_cmr/blob/master/install_gn_module.py">exemple du module CMR</a>)</li>
</ul>
</li>
<li><p class="first">La racine du module comportera les dossiers suivants :</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">backend</span></code> : dossier comportant l’API du module utilisant un blueprint Flask</li>
<li>Le fichier <code class="docutils literal"><span class="pre">blueprint.py</span></code> comprend les routes du module (ou instancie les nouveaux blueprints du module)</li>
<li>Le fichier <code class="docutils literal"><span class="pre">models.py</span></code> comprend les modèles SQLAlchemy des tables du module.</li>
<li><code class="docutils literal"><span class="pre">frontend</span></code> : le dossier <code class="docutils literal"><span class="pre">app</span></code> comprend les fichiers typescript du module, et le dossier <code class="docutils literal"><span class="pre">assets</span></code> l’ensemble des médias (images, son).<ul>
<li>Le dossier <code class="docutils literal"><span class="pre">app</span></code> doit comprendre le “module Angular racine”, celui-ci doit impérativement s’appeler <code class="docutils literal"><span class="pre">gnModule.module.ts</span></code></li>
<li>Le dossier <code class="docutils literal"><span class="pre">app</span></code> doit contenir un fichier <code class="docutils literal"><span class="pre">module.config.ts</span></code>. Ce fichier est automatiquement synchronisé avec le fichier de configuration du module <code class="docutils literal"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/external_modules/&lt;nom_module&gt;/conf_gn_module.toml</span></code> grâce à la commande <code class="docutils literal"><span class="pre">geonature</span> <span class="pre">update_module_configuration</span> <span class="pre">&lt;nom_module&gt;</span></code>. C’est à partir de ce fichier que toutes les configuration doivent pointer.</li>
<li>A la racine du dossier <code class="docutils literal"><span class="pre">frontend</span></code>, on retrouve également un fichier <code class="docutils literal"><span class="pre">package.json</span></code> qui décrit l’ensemble des librairies JS necessaires au module.</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">data</span></code> : ce dossier comprenant les scripts SQL d’installation du module</li>
</ul>
</li>
</ul>
<p>Le module est ensuite installable à la manière d’un plugin grâce à la commande <code class="docutils literal"><span class="pre">geonature</span> <span class="pre">install_gn_module</span></code> de la manière suivante:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># se placer dans le répertoire backend de GeoNature</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">GEONATURE_DIRECTORY</span><span class="o">&gt;/</span><span class="n">backend</span>
<span class="c1"># activer le virtualenv python</span>
<span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="c1"># lancer la commande d&#39;installation</span>
<span class="n">geonature</span> <span class="n">install_gn_module</span> <span class="o">&lt;</span><span class="n">CHEMIN_ABSOLU_DU_MODULE</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">URL_API</span><span class="o">&gt;</span>
<span class="c1"># example geonature install_gn_module /home/moi/gn_module_validation /validation</span>
</pre></div>
</div>
</div>
<div class="section" id="bonnes-pratiques">
<h3>Bonnes pratiques<a class="headerlink" href="#bonnes-pratiques" title="Permalink to this headline">¶</a></h3>
<div class="section" id="frontend">
<h4>Frontend<a class="headerlink" href="#frontend" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Pour l’ensemble des composants cartographiques et des formulaires (taxonomie, nomenclatures…), il est conseillé d’utiliser les composants présents dans le module ‘GN2CommonModule’.</p>
<p>Importez ce module dans le module racine de la manière suivante :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">{</span> <span class="n">GN2CommonModule</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;@geonature_common/GN2Common.module&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Les librairies JS seront installées par npm dans un dossier <code class="docutils literal"><span class="pre">node_modules</span></code> à la racine du dossier <code class="docutils literal"><span class="pre">frontend</span></code> du module. (Il n’est pas nécessaire de réinstaller toutes les librairies déjà présentes dans GeoNature (Angular, Leaflet, ChartJS …). Le <code class="docutils literal"><span class="pre">package.json</span></code> de GeoNature liste l’ensemble des librairies déjà installées et réutilisable dans le module.</p>
</li>
</ul>
<p>Lancer <code class="docutils literal"><span class="pre">npm</span> <span class="pre">init</span></code> pour initialiser le module.</p>
<ul class="simple">
<li>Les fichiers d’assets sont à ranger dans le dossier <code class="docutils literal"><span class="pre">assets</span></code> du frontend. Angular-cli impose cependant que tous les assets soient dans le répertoire mère de l’application (celui de GeoNature). Un lien symbolique est créé à l’installation du module pour faire entre le dossier d’assets du module et celui de Geonature.</li>
<li>Utiliser node_modules présent dans GeoNature</li>
</ul>
<p>Pour utiliser des librairies déjà installées dans GeoNature, utilisez la syntaxe suivante :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">{</span> <span class="n">TreeModule</span> <span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;@librairies/angular-tree-component&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>L’alias <cite>&#64;librairies</cite> pointe en effet vers le repertoire des node_modules de GeoNature</p>
<p>Pour les utiliser à l’interieur du module, utiliser la syntaxe suivante :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;external_assets/&lt;MY_MODULE_CODE&gt;/afb.png&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Exemple pour le module de validation :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;external_assets/&lt;gn_module_validation&gt;/afb.png&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li>Installer le linter <code class="docutils literal"><span class="pre">tslint</span></code> dans son éditeur de texte (TODO: définir un style à utiliser)</li>
</ul>
</div>
<div class="section" id="backend">
<h4>Backend<a class="headerlink" href="#backend" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Respecter la norme PEP8</li>
</ul>
</div>
</div>
<div class="section" id="installer-un-gn-module">
<h3>Installer un gn_module<a class="headerlink" href="#installer-un-gn-module" title="Permalink to this headline">¶</a></h3>
<p>Renseignez l’éventuel fichier <code class="docutils literal"><span class="pre">config/settings.ini</span></code> du module.</p>
<p>Pour installer un module, rendez vous dans le dossier <code class="docutils literal"><span class="pre">backend</span></code> de GeoNature.</p>
<p>Activer ensuite le virtualenv pour rendre disponible les commandes GeoNature :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>Lancez ensuite la commande :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">geonature</span> <span class="n">install_gn_module</span> <span class="o">&lt;</span><span class="n">mon_chemin_absolu_vers_le_module</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">url_api</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Le premier paramètre est l’emplacement absolu du module sur votre machine et le 2ème le chemin derrière lequel on retrouvera les routes de l’API du module.</p>
<p>Exemple pour atteindre les routes du module de validation à l’adresse ‘<a class="reference external" href="http://mon-geonature.fr/api/geonature/validation">http://mon-geonature.fr/api/geonature/validation</a>’</p>
<p>Cette commande exécute les actions suivantes :</p>
<ul class="simple">
<li>Vérification de la conformité de la structure du module (présence des fichiers et dossiers obligatoires)</li>
<li>Intégration du blueprint du module dans l’API de GeoNature</li>
<li>Vérification de la conformité des paramètres utilisateurs</li>
<li>Génération du routing Angular pour le frontend</li>
<li>Re-build du frontend pour une mise en production</li>
</ul>
<p>Complétez l’éventuelle configuration du module (<code class="docutils literal"><span class="pre">config/conf_gn_module.toml</span></code>) à partir des paramètres présents dans <code class="docutils literal"><span class="pre">config/conf_gn_module.toml.example</span></code> dont vous pouvez surcoucher les valeurs par défaut. Puis relancez la mise à jour de la configuration (depuis le répertoire <code class="docutils literal"><span class="pre">geonature/backend</span></code> et une fois dans le venv (<code class="docutils literal"><span class="pre">source</span> <span class="pre">venv/bin/activate</span></code>) : <code class="docutils literal"><span class="pre">geonature</span> <span class="pre">update_module_configuration</span> <span class="pre">nom_du_module</span></code>)</p>
</div>
</div>
<div class="section" id="developpement-backend">
<h2>Développement Backend<a class="headerlink" href="#developpement-backend" title="Permalink to this headline">¶</a></h2>
<div class="section" id="demarrage-du-serveur-de-dev-backend">
<h3>Démarrage du serveur de dev backend<a class="headerlink" href="#demarrage-du-serveur-de-dev-backend" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>(venv)...$ geonature dev_back
</pre></div>
</div>
</div>
<div class="section" id="base-de-donnees">
<h3>Base de données<a class="headerlink" href="#base-de-donnees" title="Permalink to this headline">¶</a></h3>
<div class="section" id="session-sqlalchemy">
<h4>Session sqlalchemy<a class="headerlink" href="#session-sqlalchemy" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.utils.env.DB</span></code></li>
</ul>
<p>Fournit l’instance de connexion SQLAlchemy Python</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geonature.utils.env</span> <span class="k">import</span> <span class="n">DB</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="serialisation-des-modeles">
<h3>Serialisation des modèles<a class="headerlink" href="#serialisation-des-modeles" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.utils.utilssqlalchemy.serializable</span></code></li>
</ul>
<p>Décorateur pour les modèles SQLA : Ajoute une méthode <code class="docutils literal"><span class="pre">as_dict</span></code> qui retourne un dictionnaire des données de l’objet sérialisable json</p>
<p>Fichier définition modèle</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geonature.utils.env</span> <span class="k">import</span> <span class="n">DB</span>
<span class="kn">from</span> <span class="nn">geonature.utils.utilssqlalchemy</span> <span class="k">import</span> <span class="n">serializable</span>

<span class="nd">@serializable</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">DB</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;bla&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Fichier utilisation modele</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.utils.utilssqlalchemy.geoserializable</span></code></li>
</ul>
<p>Décorateur pour les modèles SQLA : Ajoute une méthode as_geofeature qui retourne un dictionnaire serialisable sous forme de Feature geojson.</p>
<p>Fichier définition modèle</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geonature.utils.env</span> <span class="k">import</span> <span class="n">DB</span>
<span class="kn">from</span> <span class="nn">geonature.utils.utilssqlalchemy</span> <span class="k">import</span> <span class="n">geoserializable</span>

<span class="nd">@geoserializable</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">DB</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;bla&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Fichier utilisation modele</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyModel</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">as_geofeature</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.utils.utilsgeometry.shapeserializable</span></code></li>
</ul>
<p>Décorateur pour les modèles SQLA :</p>
<ul class="simple">
<li>Ajoute une méthode <code class="docutils literal"><span class="pre">as_list</span></code> qui retourne l’objet sous forme de tableau (utilisé pour créer des shapefiles)</li>
<li>Ajoute une méthode de classe <code class="docutils literal"><span class="pre">to_shape</span></code> qui crée des shapefiles à partir des données passées en paramètre</li>
</ul>
<p>Fichier définition modèle</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geonature.utils.env</span> <span class="k">import</span> <span class="n">DB</span>
<span class="kn">from</span> <span class="nn">geonature.utils.utilsgeometry</span> <span class="k">import</span> <span class="n">shapeserializable</span>

<span class="nd">@shapeserializable</span>
<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">DB</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;bla&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Fichier utilisation modele</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># utilisation de as_shape()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyShapeserializableClass</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">MyShapeserializableClass</span><span class="o">.</span><span class="n">as_shape</span><span class="p">(</span>
    <span class="n">geom_col</span><span class="o">=</span><span class="s1">&#39;geom_4326&#39;</span><span class="p">,</span>
    <span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">dir_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ROOT_DIR</span> <span class="o">/</span> <span class="s1">&#39;backend/static/shapefiles&#39;</span><span class="p">),</span>
    <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.utils.utilsgeometry.FionaShapeService</span></code></li>
</ul>
<p>Classe utilitaire pour créer des shapefiles.</p>
<p>La classe contient 3 méthodes de classe :</p>
<ul class="simple">
<li>FionaShapeService.create_shapes_struct() : crée la structure de 3 shapefiles (point, ligne, polygone) à partir des colonens et de la geométrie passée en paramètre</li>
<li>FionaShapeService.create_feature() : ajoute un enregistrement aux shapefiles</li>
<li>FionaShapeService.save_and_zip_shapefiles() : sauvegarde et zip les shapefiles qui ont au moins un enregistrement</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MySQLAModel</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">FionaShapeService</span><span class="o">.</span><span class="n">create_shapes_struct</span><span class="p">(</span>
                <span class="n">db_cols</span><span class="o">=</span><span class="n">db_cols</span><span class="p">,</span>
                <span class="n">srid</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;LOCAL_SRID&#39;</span><span class="p">],</span>
                <span class="n">dir_path</span><span class="o">=</span><span class="n">dir_path</span><span class="p">,</span>
                <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                <span class="n">col_mapping</span><span class="o">=</span><span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SYNTHESE&#39;</span><span class="p">][</span><span class="s1">&#39;EXPORT_COLUMNS&#39;</span><span class="p">]</span>
        <span class="p">)</span>
<span class="n">FionaShapeService</span><span class="o">.</span><span class="n">create_feature</span><span class="p">(</span><span class="n">row_as_dict</span><span class="p">,</span> <span class="n">geom</span><span class="p">)</span>
        <span class="n">FionaShapeService</span><span class="o">.</span><span class="n">save_and_zip_shapefiles</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.utils.utilssqlalchemy.json_resp</span></code></li>
</ul>
<p>Décorateur pour les routes : les données renvoyées par la route sont automatiquement serialisées en json (ou geojson selon la structure des données)</p>
<p>S’insère entre le décorateur de route flask et la signature de fonction</p>
<p>Fichier routes</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span>
<span class="kn">from</span> <span class="nn">geonature.utils.utilssqlalchemy</span> <span class="k">import</span> <span class="n">json_resp</span>

<span class="n">blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@blueprint</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/myview&#39;</span><span class="p">)</span>
<span class="nd">@json_resp</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;OK&#39;</span><span class="p">}</span>


<span class="nd">@blueprint</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/myerrview&#39;</span><span class="p">)</span>
<span class="nd">@json_resp</span>
<span class="k">def</span> <span class="nf">my_err_view</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;Not OK&#39;</span><span class="p">},</span> <span class="mi">400</span>
</pre></div>
</div>
</div>
<div class="section" id="export-des-donnees">
<h3>Export des données<a class="headerlink" href="#export-des-donnees" title="Permalink to this headline">¶</a></h3>
<p>TODO</p>
</div>
<div class="section" id="utilisation-de-la-configuration">
<h3>Utilisation de la configuration<a class="headerlink" href="#utilisation-de-la-configuration" title="Permalink to this headline">¶</a></h3>
<p>La configuration globale de l’application est controlée par le fichier <code class="docutils literal"><span class="pre">config/geonature_config.toml</span></code> qui contient un nombre limité de paramètres. De nombreux paramètres sont néammoins passés à l’application via un schéma Marshmallow (voir fichier <code class="docutils literal"><span class="pre">backend/geonature/utils/config_schema.py</span></code>).</p>
<p>Dans l’application flask, l’ensemble des paramètres de configuration sont utilisables via le dictionnaire <code class="docutils literal"><span class="pre">config</span></code> de l’application Flask :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">current_app</span>
<span class="n">MY_PARAMETER</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MY_PARAMETER&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Chaque module GeoNature dispose de son propre fichier de configuration, (<code class="docutils literal"><span class="pre">module/config/cong_gn_module.toml</span></code>) contrôlé de la même manière par un schéma Marshmallow (<code class="docutils literal"><span class="pre">module/config/conf_schema_toml.py</span></code>).
Pour récupérer la configuration du module dans l’application Flask, il existe deux méthodes:</p>
<p>Dans le fichier <code class="docutils literal"><span class="pre">blueprint.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Methode 1:</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">current_app</span>
<span class="n">MY_MODULE_PARAMETER</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MY_MODULE_NAME&#39;</span><span class="p">][</span><span class="s1">&#39;MY_PARAMETER]</span>
<span class="c1"># ou MY_MODULE_NAME est le nom du module tel qu&#39;il est défini dans le fichier ``manifest.toml`` et la table ``gn_commons.t_modules``</span>

<span class="c1">#Méthode 2</span>
<span class="n">MY_MODULE_PARAMETER</span> <span class="o">=</span> <span class="n">blueprint</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MY_MODULE_PARAMETER&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Il peut-être utile de récupérer l’ID du module GeoNature (notamment pour des questions droits). De la même manière que précédement, à l’interieur d’une route, on peut récupérer l’ID du module de la manière suivante :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ID_MODULE</span> <span class="o">=</span> <span class="n">blueprint</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ID_MODULE&#39;</span><span class="p">]</span>
<span class="c1"># ou</span>
<span class="n">ID_MODULE</span> <span class="o">=</span> <span class="n">current_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MODULE_NAME&#39;</span><span class="p">][</span><span class="s1">&#39;ID_MODULE&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Si on souhaite récupérer l’ID du module en dehors du contexte d’une route, il faut utiliser la méthode suivante :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geonature.utils.env</span> <span class="k">import</span> <span class="n">get_id_module</span>
<span class="n">ID_MODULE</span> <span class="o">=</span> <span class="n">get_id_module</span><span class="p">(</span><span class="n">current_app</span><span class="p">,</span> <span class="s1">&#39;occtax&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="authentification-avec-pypnusershub">
<h3>Authentification avec pypnusershub<a class="headerlink" href="#authentification-avec-pypnusershub" title="Permalink to this headline">¶</a></h3>
<div class="section" id="verification-des-droits-des-utilisateurs">
<h4>Vérification des droits des utilisateurs<a class="headerlink" href="#verification-des-droits-des-utilisateurs" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pypnusershub.routes.check_auth</span></code></li>
</ul>
<p>Décorateur pour les routes : vérifie les droits de l’utilisateur et le redirige en cas de niveau insuffisant ou d’informations de session erronés
(deprecated) Privilegier <cite>check_cruved_scope</cite></p>
<p>params :</p>
<ul class="simple">
<li>level &lt;int&gt; : niveau de droits requis pour accéder à la vue</li>
<li>get_role &lt;bool:False&gt; : si True, ajoute l’id utilisateur aux kwargs de la vue</li>
<li>redirect_on_expiration &lt;str:None&gt; : identifiant de vue  sur laquelle rediriger l’utilisateur en cas d’expiration de sa session</li>
<li>redirect_on_invalid_token &lt;str:None&gt; : identifiant de vue sur laquelle rediriger l’utilisateur en cas d’informations de session invalides</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span>
<span class="kn">from</span> <span class="nn">pypnusershub.routes</span> <span class="k">import</span> <span class="n">check_auth</span>
<span class="kn">from</span> <span class="nn">geonature.utils.utilssqlalchemy</span> <span class="k">import</span> <span class="n">json_resp</span>

<span class="n">blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@blueprint</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/myview&#39;</span><span class="p">)</span>
<span class="nd">@check_auth</span><span class="p">(</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="kc">True</span><span class="p">,</span>
        <span class="n">redirect_on_expiration</span><span class="o">=</span><span class="s1">&#39;my_reconnexion_handler&#39;</span><span class="p">,</span>
        <span class="n">redirect_on_invalid_token</span><span class="o">=</span><span class="s1">&#39;my_affreux_pirate_handler&#39;</span>
        <span class="p">)</span>
<span class="nd">@json_resp</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">id_role</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;id_role = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">id_role</span><span class="p">)}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.core.gn_permissions.decorators.check_cruved_scope</span></code></li>
</ul>
<p>Décorateur pour les routes : Vérifie les droits de l’utilisateur à effectuer une action sur la donnée et le redirige en cas de niveau insuffisant ou d’informations de session erronées</p>
<p>params :</p>
<ul class="simple">
<li>action &lt;str:[‘C’,’R’,’U’,’V’,’E’,’D’]&gt; type d’action effectuée par la route (Create, Read, Update, Validate, Export, Delete)</li>
<li>get_role &lt;bool:False&gt;: si True, ajoute l’id utilisateur aux kwargs de la vue</li>
<li>module_code: &lt;str:None&gt;: Code du module (gn_commons.t_modules) sur lequel on veut récupérer le CRUVED. Si ce paramètre n’est pas passer on vérifie le cruved de GeoNature</li>
<li>redirect_on_expiration &lt;str:None&gt; : identifiant de vue ou URL sur laquelle rediriger l’utilisateur en cas d’expiration de sa session</li>
<li>redirect_on_invalid_token &lt;str:None&gt; : identifiant de vue ou URL sur laquelle rediriger l’utilisateur en cas d’informations de session invalides</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="k">import</span> <span class="n">Blueprint</span>
<span class="kn">from</span> <span class="nn">geonature.core.gn_permissions.tools</span> <span class="k">import</span> <span class="n">get_or_fetch_user_cruved</span>
<span class="kn">from</span> <span class="nn">geonature.utils.utilssqlalchemy</span> <span class="k">import</span> <span class="n">json_resp</span>
<span class="kn">from</span> <span class="nn">geonature.core.gn_permissions</span> <span class="k">import</span> <span class="n">decorators</span> <span class="k">as</span> <span class="n">permissions</span>

<span class="n">blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@blueprint</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/mysensibleview&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@permissions</span><span class="o">.</span><span class="n">check_cruved_scope</span><span class="p">(</span>
        <span class="s1">&#39;R&#39;</span><span class="p">,</span>
        <span class="kc">True</span><span class="p">,</span>
        <span class="n">module_code</span><span class="o">=</span><span class="s2">&quot;OCCTAX&quot;</span>
        <span class="n">redirect_on_expiration</span><span class="o">=</span><span class="s1">&#39;my_reconnexion_handler&#39;</span><span class="p">,</span>
        <span class="n">redirect_on_invalid_token</span><span class="o">=</span><span class="s1">&#39;my_affreux_pirate_handler&#39;</span>
<span class="p">)</span>
<span class="nd">@json_resp</span>
<span class="k">def</span> <span class="nf">my_sensible_view</span><span class="p">(</span><span class="n">info_role</span><span class="p">):</span>
    <span class="c1"># Récupérer l&#39;id de l&#39;utilisateur qui demande la route</span>
    <span class="n">id_role</span> <span class="o">=</span> <span class="n">info_role</span><span class="o">.</span><span class="n">id_role</span>
    <span class="c1"># Récupérer la portée autorisée à l&#39;utilisateur pour l&#39;action &#39;R&#39; (read)</span>
    <span class="n">read_scope</span> <span class="o">=</span> <span class="n">info_role</span><span class="o">.</span><span class="n">value_filter</span>
    <span class="c1">#récupérer le CRUVED complet de l&#39;utilisateur courant</span>
    <span class="n">user_cruved</span> <span class="o">=</span> <span class="n">get_or_fetch_user_cruved</span><span class="p">(</span>
            <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
            <span class="n">id_role</span><span class="o">=</span><span class="n">info_role</span><span class="o">.</span><span class="n">id_role</span><span class="p">,</span>
            <span class="n">module_code</span><span class="o">=</span><span class="n">MY_MODULE_CODE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;id_role = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info_role</span><span class="o">.</span><span class="n">id_role</span><span class="p">)}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">geonature.core.gn_permissions.tools.cruved_scope_for_user_in_module</span></code></li>
</ul>
<ul class="simple">
<li>Fonction qui retourne le CRUVED d’un utilisateur pour un module et/ou un objet donné.</li>
<li>Si aucun CRUVED n’est défini pour le module, c’est celui de GeoNature qui est retourné, sinon 0.</li>
<li>Le CRUVED du module enfant surcharge toujours celui du module parent.</li>
<li>Le CRUVED sur les objets n’est pas hérité du module parent.</li>
</ul>
<p>params :</p>
<ul class="simple">
<li>id_role &lt;integer:None&gt;</li>
<li>module_code &lt;str:None&gt;: code du module sur lequel on veut avoir le CRUVED</li>
<li>object_code &lt;str:’ALL’&gt; : code de l’objet sur lequel on veut avoir le CRUVED</li>
<li>get_id &lt;boolean: False&gt; : retourne l’id_filter et non le code_filter si True</li>
</ul>
<p>Valeur retournée : tuple</p>
<p>A l’indice 0 du tuple: &lt;dict{str:str}&gt; ou &lt;dict{str:int}&gt;, boolean) {‘C’: ‘1’, ‘R’:‘2’, ‘U’: ‘1’, ‘V’:‘2’, ‘E’:‘3’, ‘D’: ‘3’} ou {‘C’: 2, ‘R’:3, ‘U’: 4, ‘V’:1, ‘E’:2, ‘D’: 2} si <code class="docutils literal"><span class="pre">get_id=True</span></code></p>
<p>A l’indice 1 du tuple: un booléan spécifiant si le CRUVED est hérité depuis un module parent ou non.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pypnusershub.db.tools</span> <span class="k">import</span> <span class="n">cruved_for_user_in_app</span>

<span class="c1"># recuperer le cruved de l&#39;utilisateur 1 dans le module OCCTAX</span>
<span class="n">cruved</span><span class="p">,</span> <span class="n">herited</span> <span class="o">=</span> <span class="n">cruved_scope_for_user_in_module</span><span class="p">(</span>
        <span class="n">id_role</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">module_code</span><span class="o">=</span><span class="s1">&#39;OCCTAX</span>
<span class="p">)</span>
<span class="c1"># recupérer le cruved de l&#39;utilisateur 1 sur GeoNature</span>
<span class="n">cruved</span><span class="p">,</span> <span class="n">herited</span> <span class="o">=</span> <span class="n">cruved_scope_for_user_in_module</span><span class="p">(</span><span class="n">id_role</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="documentation-api-backend">
<h3>Documentation API Backend<a class="headerlink" href="#documentation-api-backend" title="Permalink to this headline">¶</a></h3>
<div class="section" id="liste-des-routes">
<h4>Liste des routes<a class="headerlink" href="#liste-des-routes" title="Permalink to this headline">¶</a></h4>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="45%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Resource</th>
<th class="head">Operation</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--nomenclatures-nomenclatures">GET /nomenclatures/nomenclatures</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--nomenclatures-nomenclature-(int-id_type)">GET /nomenclatures/nomenclature/(int:id_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--nomenclatures-nomenclature-(string-code_type)">GET /nomenclatures/nomenclature/(string:code_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Commons</td>
<td><a class="reference external" href="#get--gn_commons-list-parameters">GET /gn_commons/list/parameters</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--gn_commons-modules">GET /gn_commons/modules</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#put--gn_commons-media-(int-id_media)">PUT /gn_commons/media/(int:id_media)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#put--gn_commons-media">PUT /gn_commons/media</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--gn_commons-media-(int-id_media)">POST /gn_commons/media/(int:id_media)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--gn_commons-media">POST /gn_commons/media</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--gn_commons-media-(int-id_media)">GET /gn_commons/media/(int:id_media)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#delete--gn_commons-media-(int-id_media)">DELETE /gn_commons/media/(int:id_media)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Generic</td>
<td><a class="reference external" href="#get--config">GET /config</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--genericview-(view_schema)-(view_name)">GET /genericview/(view_schema)/(view_name)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Metadata</td>
<td><a class="reference external" href="#get--meta-acquisition_frameworks">GET /meta/acquisition_frameworks</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--meta-acquisition_framework">POST /meta/acquisition_framework</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--meta-datasets">GET /meta/datasets</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--meta-dataset">POST /meta/dataset</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--meta-aquisition_framework_mtd-(uuid_af)">POST /meta/aquisition_framework_mtd/(uuid_af)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--meta-acquisition_framework-(id_acquisition_framework)">GET /meta/acquisition_framework/(id_acquisition_framework)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--meta-dataset_mtd-(id_user)-(id_organism)">POST /meta/dataset_mtd/(id_user)/(id_organism)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--meta-dataset_mtd-(id_user)">POST /meta/dataset_mtd/(id_user)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--meta-dataset-(id_dataset)">GET /meta/dataset/(id_dataset)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Monitoring</td>
<td><a class="reference external" href="#get--gn_monitoring-siteslist">GET /gn_monitoring/siteslist</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--gn_monitoring-siteslist-(int-id_site)">GET /gn_monitoring/siteslist/(int:id_site)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--gn_monitoring-siteareas-(int-id_site)">GET /gn_monitoring/siteareas/(int:id_site)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Occtax</td>
<td><a class="reference external" href="#get--occtax-defaultNomenclatures">GET /occtax/defaultNomenclatures</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--occtax-occurrences">GET /occtax/occurrences</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--occtax-releves">GET /occtax/releves</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--occtax-vreleve">GET /occtax/vreleve</a></td>
<td>Get releves used for frontend map-list</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--occtax-releve">POST /occtax/releve</a></td>
<td>Post one Occtax data (Releve + Occurrence + Counting)</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--occtax-export">GET /occtax/export</a></td>
<td>Export data from pr_occtax.export_occtax_sinp</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#delete--occtax-releve-occurrence_counting-(int-id_count)">DELETE /occtax/releve/occurrence_counting/(int:id_count)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#delete--occtax-releve-occurrence-(int-id_occ)">DELETE /occtax/releve/occurrence/(int:id_occ)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--occtax-counting-(int-id_counting)">GET /occtax/counting/(int:id_counting)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--occtax-releve-(int-id_releve)">GET /occtax/releve/(int:id_releve)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#delete--occtax-releve-(int-id_releve)">DELETE /occtax/releve/(int:id_releve)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Permissions</td>
<td><a class="reference external" href="#get--permissions-logout_cruved">GET /permissions/logout_cruved</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions-cruved">GET /permissions/cruved</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Ref Geo</td>
<td><a class="reference external" href="#get--geo-municipalities">GET /geo/municipalities</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--geo-areas">POST /geo/areas</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--geo-areas">GET /geo/areas</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--geo-info">POST /geo/info</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Synthese</td>
<td><a class="reference external" href="#get--synthese-defaultsNomenclatures">GET /synthese/defaultsNomenclatures</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--synthese-export_observations">POST /synthese/export_observations</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-taxons_autocomplete">GET /synthese/taxons_autocomplete</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-export_metadata">GET /synthese/export_metadata</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-export_statuts">GET /synthese/export_statuts</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-general_stats">GET /synthese/general_stats</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-taxons_tree">GET /synthese/taxons_tree</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-color_taxon">GET /synthese/color_taxon</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-for_web">GET /synthese/for_web</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-sources">GET /synthese/sources</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese">GET /synthese</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--synthese-vsynthese-(id_synthese)">GET /synthese/vsynthese/(id_synthese)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>User</td>
<td><a class="reference external" href="#get--gn_auth-logout_cruved">GET /gn_auth/logout_cruved</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--gn_auth-login_cas">GET /gn_auth/login_cas</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--gn_auth-login_cas">POST /gn_auth/login_cas</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--users-organisms_dataset_actor">GET /users/organisms_dataset_actor</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--users-organisms">GET /users/organisms</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--users-cor_role">POST /users/cor_role</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--users-organism">POST /users/organism</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--users-roles">GET /users/roles</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--users-role">POST /users/role</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--users-menu-(int-id_menu)">GET /users/menu/(int:id_menu)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--users-role-(int-id_role)">GET /users/role/(int:id_role)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>View_Permission</td>
<td><a class="reference external" href="#get--permissions_backoffice-users">GET /permissions_backoffice/users</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-other_permissions_form-id_permission-(int-id_permission)-user-(int-id_role)-filter_type-(int-id_filter_type)">GET /permissions_backoffice/other_permissions_form/id_permission/(int:id_permission)/user/(int:id_role)/filter_type/(int:id_filter_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-other_permissions_form-user-(int-id_role)-filter_type-(int-id_filter_type)">GET /permissions_backoffice/other_permissions_form/user/(int:id_role)/filter_type/(int:id_filter_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--permissions_backoffice-other_permissions_form-id_permission-(int-id_permission)-user-(int-id_role)-filter_type-(int-id_filter_type)">POST /permissions_backoffice/other_permissions_form/id_permission/(int:id_permission)/user/(int:id_role)/filter_type/(int:id_filter_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--permissions_backoffice-other_permissions_form-user-(int-id_role)-filter_type-(int-id_filter_type)">POST /permissions_backoffice/other_permissions_form/user/(int:id_role)/filter_type/(int:id_filter_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)-object-(int-id_object)">GET /permissions_backoffice/cruved_form/module/(int:id_module)/role/(int:id_role)/object/(int:id_object)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)">GET /permissions_backoffice/cruved_form/module/(int:id_module)/role/(int:id_role)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)-object-(int-id_object)">POST /permissions_backoffice/cruved_form/module/(int:id_module)/role/(int:id_role)/object/(int:id_object)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)">POST /permissions_backoffice/cruved_form/module/(int:id_module)/role/(int:id_role)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)-id_filter-(int-id_filter)">GET /permissions_backoffice/filter_form/id_filter_type/(int:id_filter_type)/id_filter/(int:id_filter)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)">GET /permissions_backoffice/filter_form/id_filter_type/(int:id_filter_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#post--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)-id_filter-(int-id_filter)">POST /permissions_backoffice/filter_form/id_filter_type/(int:id_filter_type)/id_filter/(int:id_filter)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)">POST /permissions_backoffice/filter_form/id_filter_type/(int:id_filter_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-filter_list-id_filter_type-(int-id_filter_type)">GET /permissions_backoffice/filter_list/id_filter_type/(int:id_filter_type)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-user_other_permissions-(id_role)">GET /permissions_backoffice/user_other_permissions/(id_role)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>&#160;</td>
<td><a class="reference external" href="#get--permissions_backoffice-user_cruved-(id_role)">GET /permissions_backoffice/user_cruved/(id_role)</a></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><a class="reference external" href="#post--permissions_backoffice-filter-(id_filter)">POST /permissions_backoffice/filter/(id_filter)</a></td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="documentation-des-routes">
<h4>Documentation des routes<a class="headerlink" href="#documentation-des-routes" title="Permalink to this headline">¶</a></h4>
<dl class="post">
<dt id="post--nomenclatures-admin-bibnomenclaturestypesadmin-ajax-update-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/ajax/update/</code><a class="headerlink" href="#post--nomenclatures-admin-bibnomenclaturestypesadmin-ajax-update-" title="Permalink to this definition">¶</a></dt>
<dd><p>Edits a single column of a record in list view.</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-tnomenclaturesadmin-ajax-update-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/ajax/update/</code><a class="headerlink" href="#post--nomenclatures-admin-tnomenclaturesadmin-ajax-update-" title="Permalink to this definition">¶</a></dt>
<dd><p>Edits a single column of a record in list view.</p>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-admin-bibnomenclaturestypesadmin-details-">
<code class="descname">GET </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/details/</code><a class="headerlink" href="#get--nomenclatures-admin-bibnomenclaturestypesadmin-details-" title="Permalink to this definition">¶</a></dt>
<dd><p>Details model view</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-bibnomenclaturestypesadmin-action-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/action/</code><a class="headerlink" href="#post--nomenclatures-admin-bibnomenclaturestypesadmin-action-" title="Permalink to this definition">¶</a></dt>
<dd><p>Mass-model action view.</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-bibnomenclaturestypesadmin-delete-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/delete/</code><a class="headerlink" href="#post--nomenclatures-admin-bibnomenclaturestypesadmin-delete-" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete model view. Only POST method is allowed.</p>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-admin-bibnomenclaturestypesadmin-edit-">
<code class="descname">GET </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/edit/</code><a class="headerlink" href="#get--nomenclatures-admin-bibnomenclaturestypesadmin-edit-" title="Permalink to this definition">¶</a></dt>
<dd><p>Edit model view</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-bibnomenclaturestypesadmin-edit-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/edit/</code><a class="headerlink" href="#post--nomenclatures-admin-bibnomenclaturestypesadmin-edit-" title="Permalink to this definition">¶</a></dt>
<dd><p>Edit model view</p>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-admin-bibnomenclaturestypesadmin-new-">
<code class="descname">GET </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/new/</code><a class="headerlink" href="#get--nomenclatures-admin-bibnomenclaturestypesadmin-new-" title="Permalink to this definition">¶</a></dt>
<dd><p>Create model view</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-bibnomenclaturestypesadmin-new-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/bibnomenclaturestypesadmin/new/</code><a class="headerlink" href="#post--nomenclatures-admin-bibnomenclaturestypesadmin-new-" title="Permalink to this definition">¶</a></dt>
<dd><p>Create model view</p>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-admin-tnomenclaturesadmin-details-">
<code class="descname">GET </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/details/</code><a class="headerlink" href="#get--nomenclatures-admin-tnomenclaturesadmin-details-" title="Permalink to this definition">¶</a></dt>
<dd><p>Details model view</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-tnomenclaturesadmin-action-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/action/</code><a class="headerlink" href="#post--nomenclatures-admin-tnomenclaturesadmin-action-" title="Permalink to this definition">¶</a></dt>
<dd><p>Mass-model action view.</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-tnomenclaturesadmin-delete-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/delete/</code><a class="headerlink" href="#post--nomenclatures-admin-tnomenclaturesadmin-delete-" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete model view. Only POST method is allowed.</p>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-admin-tnomenclaturesadmin-edit-">
<code class="descname">GET </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/edit/</code><a class="headerlink" href="#get--nomenclatures-admin-tnomenclaturesadmin-edit-" title="Permalink to this definition">¶</a></dt>
<dd><p>Edit model view</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-tnomenclaturesadmin-edit-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/edit/</code><a class="headerlink" href="#post--nomenclatures-admin-tnomenclaturesadmin-edit-" title="Permalink to this definition">¶</a></dt>
<dd><p>Edit model view</p>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-admin-tnomenclaturesadmin-new-">
<code class="descname">GET </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/new/</code><a class="headerlink" href="#get--nomenclatures-admin-tnomenclaturesadmin-new-" title="Permalink to this definition">¶</a></dt>
<dd><p>Create model view</p>
</dd></dl>

<dl class="post">
<dt id="post--nomenclatures-admin-tnomenclaturesadmin-new-">
<code class="descname">POST </code><code class="descname">/nomenclatures/admin/tnomenclaturesadmin/new/</code><a class="headerlink" href="#post--nomenclatures-admin-tnomenclaturesadmin-new-" title="Permalink to this definition">¶</a></dt>
<dd><p>Create model view</p>
</dd></dl>

<dl class="get">
<dt id="get--gn_commons-list-parameters">
<code class="descname">GET </code><code class="descname">/gn_commons/list/parameters</code><a class="headerlink" href="#get--gn_commons-list-parameters" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all parameters from gn_commons.t_parameters
.. :quickref: Commons;</p>
</dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-users">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/users</code><a class="headerlink" href="#get--permissions_backoffice-users" title="Permalink to this definition">¶</a></dt>
<dd><p>Render a list with all users with their number of cruved
Link to edit cruved and other permissions
Only display user which have profil in GeoNature and active user</p>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-nomenclatures">
<code class="descname">GET </code><code class="descname">/nomenclatures/nomenclatures</code><a class="headerlink" href="#get--nomenclatures-nomenclatures" title="Permalink to this definition">¶</a></dt>
<dd><p>Route : liste des termes d’un ensemble de nomenclatures
Possibilité de filtrer par regne et group2Inpn</p>
</dd></dl>

<dl class="get">
<dt id="get--gn_monitoring-siteslist">
<code class="descname">GET </code><code class="descname">/gn_monitoring/siteslist</code><a class="headerlink" href="#get--gn_monitoring-siteslist" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the sites list for an application in a dict {id_base_site, nom site}
.. :quickref: Monitoring;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>id_site</strong> – id of base site</li>
<li><strong>type</strong> – int</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--permissions-logout_cruved">
<code class="descname">GET </code><code class="descname">/permissions/logout_cruved</code><a class="headerlink" href="#get--permissions-logout_cruved" title="Permalink to this definition">¶</a></dt>
<dd><p>Route to logout with cruved
.. :quickref: Permissions;</p>
<p>To avoid multiples server call, we store the cruved in the session  
when the user logout we need clear the session to get the new cruved session</p>
</dd></dl>

<dl class="get">
<dt id="get--permissions-cruved">
<code class="descname">GET </code><code class="descname">/permissions/cruved</code><a class="headerlink" href="#get--permissions-cruved" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the cruved for a user
.. :quickref: Permissions;</p>
<p>Params:
:param user: the user who ask the route, auto kwargs via &#64;check_cruved_scope
:type user: User
:param module_code: the code of the requested module - as querystring
:type module_code: str</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dict of the CRUVED</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--gn_commons-modules">
<code class="descname">GET </code><code class="descname">/gn_commons/modules</code><a class="headerlink" href="#get--gn_commons-modules" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the allowed modules of user from its cruved
.. :quickref: Commons;</p>
</dd></dl>

<dl class="put">
<dt id="put--gn_commons-media-(int-id_media)">
<code class="descname">PUT </code><code class="descname">/gn_commons/media/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_media</em><span class="sig-paren">)</span><a class="headerlink" href="#put--gn_commons-media-(int-id_media)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="put">
<dt id="put--gn_commons-media">
<code class="descname">PUT </code><code class="descname">/gn_commons/media</code><a class="headerlink" href="#put--gn_commons-media" title="Permalink to this definition">¶</a></dt>
<dd><p>Insertion ou mise à jour d’un média
avec prise en compte des fichiers joints</p>
</dd></dl>

<dl class="post">
<dt id="post--gn_commons-media-(int-id_media)">
<code class="descname">POST </code><code class="descname">/gn_commons/media/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_media</em><span class="sig-paren">)</span><a class="headerlink" href="#post--gn_commons-media-(int-id_media)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="post">
<dt id="post--gn_commons-media">
<code class="descname">POST </code><code class="descname">/gn_commons/media</code><a class="headerlink" href="#post--gn_commons-media" title="Permalink to this definition">¶</a></dt>
<dd><p>Insertion ou mise à jour d’un média
avec prise en compte des fichiers joints</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-defaultsNomenclatures">
<code class="descname">GET </code><code class="descname">/synthese/defaultsNomenclatures</code><a class="headerlink" href="#get--synthese-defaultsNomenclatures" title="Permalink to this definition">¶</a></dt>
<dd><p>Get default nomenclatures
.. :quickref: Synthese;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>group2_inpn</strong> (<em>str</em>) – </li>
<li><strong>regne</strong> (<em>str</em>) – </li>
<li><strong>organism</strong> (<em>int</em>) – </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="post">
<dt id="post--synthese-export_observations">
<code class="descname">POST </code><code class="descname">/synthese/export_observations</code><a class="headerlink" href="#post--synthese-export_observations" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimized route for observations web export
.. :quickref: Synthese;
This view is customisable by the administrator
Some columns arer mandatory: id_sythese, geojson and geojson_local to generate the exported files</p>
<p>POST parameters: Use a list of id_synthese (in POST parameters) to filter the v_synthese_for_export_view</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>export_format</strong> (<em>str</em>) – str&lt;’csv’, ‘geojson’, ‘shapefiles’&gt;</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--synthese-taxons_autocomplete">
<code class="descname">GET </code><code class="descname">/synthese/taxons_autocomplete</code><a class="headerlink" href="#get--synthese-taxons_autocomplete" title="Permalink to this definition">¶</a></dt>
<dd><p>Autocomplete taxon for web search (based on all taxon in Synthese)
The request use trigram algorithm to get relevent results
.. :quickref: Synthese;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>search_name</strong> (<em>str</em>) – the search name (use sql ilike statement and puts “%” for spaces)</li>
<li><strong>regne</strong> (<em>str</em>) – filter with kingdom</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>:query str group2_inpn : filter with INPN group 2</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-export_metadata">
<code class="descname">GET </code><code class="descname">/synthese/export_metadata</code><a class="headerlink" href="#get--synthese-export_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Route to export the metadata in CSV
.. :quickref: Synthese;
The table synthese is join with gn_synthese.v_metadata_for_export
The column jdd_id is mandatory in the view gn_synthese.v_metadata_for_export</p>
<p>POST parameters: Use a list of id_synthese (in POST parameters) to filter the v_synthese_for_export_view</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-export_statuts">
<code class="descname">GET </code><code class="descname">/synthese/export_statuts</code><a class="headerlink" href="#get--synthese-export_statuts" title="Permalink to this definition">¶</a></dt>
<dd><p>Route to get all the protection status of a synthese search
.. :quickref: Synthese;
Parameters:</p>
<blockquote>
<div><ul class="simple">
<li>HTTP-GET: the same that the /synthese endpoint (all the filter in web app)</li>
</ul>
</div></blockquote>
<p>Get the CRUVED from ‘R’ action because we don’t give observations X/Y but only statuts
and to be constistant with the data displayed in the web interface</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-general_stats">
<code class="descname">GET </code><code class="descname">/synthese/general_stats</code><a class="headerlink" href="#get--synthese-general_stats" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Return stats about synthese</dt>
<dd><ul class="first last simple">
<li>nb of observations</li>
<li>nb of distinct species</li>
<li>nb of distinct observer</li>
<li>nb ob datasets</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="get">
<dt id="get--synthese-taxons_tree">
<code class="descname">GET </code><code class="descname">/synthese/taxons_tree</code><a class="headerlink" href="#get--synthese-taxons_tree" title="Permalink to this definition">¶</a></dt>
<dd><p>Get taxon tree
.. :quickref: Synthese;</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-color_taxon">
<code class="descname">GET </code><code class="descname">/synthese/color_taxon</code><a class="headerlink" href="#get--synthese-color_taxon" title="Permalink to this definition">¶</a></dt>
<dd><p>Get color of taxon in areas (table synthese.cor_area_taxon)
.. :quickref: Synthese;
:query str code_area_type: Type area code (ref_geo.bib_areas_types.type_code)
:query int id_area: Id of area (ref_geo.l_areas.id_area)
:query int cd_nom: taxon code (taxonomie.taxref.cd_nom)
Those three parameters can be multiples
Returns: Array&lt;dict&lt;VColorAreaTaxon&gt;&gt;</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-for_web">
<code class="descname">GET </code><code class="descname">/synthese/for_web</code><a class="headerlink" href="#get--synthese-for_web" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimized route for serve data to the frontend with all filters
.. :quickref: Synthese;
:query: all the fields of the view v_synthese_for_export
:returns: Array of dict (with geojson key)</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-sources">
<code class="descname">GET </code><code class="descname">/synthese/sources</code><a class="headerlink" href="#get--synthese-sources" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all sources
.. :quickref: Synthese;</p>
</dd></dl>

<dl class="get">
<dt id="get--gn_auth-logout_cruved">
<code class="descname">GET </code><code class="descname">/gn_auth/logout_cruved</code><a class="headerlink" href="#get--gn_auth-logout_cruved" title="Permalink to this definition">¶</a></dt>
<dd><p>Route to logout with cruved
To avoid multiples server call, we store the cruved in the session
when the user logout we need clear the session to get the new cruved session</p>
</dd></dl>

<dl class="get">
<dt id="get--gn_auth-login_cas">
<code class="descname">GET </code><code class="descname">/gn_auth/login_cas</code><a class="headerlink" href="#get--gn_auth-login_cas" title="Permalink to this definition">¶</a></dt>
<dd><p>Login route with the INPN CAS</p>
</dd></dl>

<dl class="post">
<dt id="post--gn_auth-login_cas">
<code class="descname">POST </code><code class="descname">/gn_auth/login_cas</code><a class="headerlink" href="#post--gn_auth-login_cas" title="Permalink to this definition">¶</a></dt>
<dd><p>Login route with the INPN CAS</p>
</dd></dl>

<dl class="get">
<dt id="get--occtax-defaultNomenclatures">
<code class="descname">GET </code><code class="descname">/occtax/defaultNomenclatures</code><a class="headerlink" href="#get--occtax-defaultNomenclatures" title="Permalink to this definition">¶</a></dt>
<dd><p>Get default nomenclatures define in occtax module</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dict: {‘MODULE_CODE’: ‘ID_NOMENCLATURE’}</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--occtax-occurrences">
<code class="descname">GET </code><code class="descname">/occtax/occurrences</code><a class="headerlink" href="#get--occtax-occurrences" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all Occurrences</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><cite>dict&lt;TOccurrencesOccurrence&gt;</cite></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--occtax-releves">
<code class="descname">GET </code><code class="descname">/occtax/releves</code><a class="headerlink" href="#get--occtax-releves" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all releves - Not used in frontend</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><cite>Geojson&lt;TReleves&gt;</cite></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--occtax-vreleve">
<code class="descname">GET </code><code class="descname">/occtax/vreleve</code><a class="headerlink" href="#get--occtax-vreleve" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the list of releves with all occurrences and counting</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>limit</strong> (<em>int</em>) – Number max of results</li>
<li><strong>offset</strong> (<em>int</em>) – Page number to return</li>
<li><strong>cd_nom</strong> (<em>int</em>) – Filter with a taxon cd_nom (multiple)</li>
<li><strong>observers</strong> (<em>int</em>) – Filter with a id_role (multiple)</li>
<li><strong>date_up</strong> – Date min of a releve</li>
<li><strong>date_low</strong> – Date max of a releve</li>
<li><strong>date_eq</strong> (<em>date</em>) – Exact date of a releve</li>
<li><strong>ordreby</strong> (<em>str</em>) – Name of the field to execute order</li>
<li><strong>(asc|desc)</strong> (<em>order</em>) – Way of the order</li>
<li><strong>organism</strong> (<em>int</em>) – Id of the organism (multiple)</li>
<li><strong>name_of_columns</strong> (<em>any</em>) – filter on any columns of the table
Filtre sur le champ NomChampTableVReleveList</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span></span>{
    &#39;total&#39;: Number total of results,
    &#39;total_filtered&#39;: Number of results after filteer ,
    &#39;page&#39;: Page number,
    &#39;limit&#39;: Limit,
    &#39;items&#39;: data on GeoJson format
}
</pre></div>
</div>
</dd></dl>

<dl class="post">
<dt id="post--occtax-releve">
<code class="descname">POST </code><code class="descname">/occtax/releve</code><a class="headerlink" href="#post--occtax-releve" title="Permalink to this definition">¶</a></dt>
<dd><p>Post one Occtax data (Releve + Occurrence + Counting)</p>
<p><strong>Request JSON object:</strong></p>
<div class="highlight-http"><div class="highlight"><pre><span></span>{
&quot;geometry&quot;:
    {&quot;type&quot;:&quot;Point&quot;,
    &quot;coordinates&quot;:[0.9008789062500001,47.14489748555398]},
    &quot;properties&quot;:
        {
        &quot;id_releve_occtax&quot;:null,&quot;id_dataset&quot;:1,&quot;id_digitiser&quot;:1,&quot;date_min&quot;:&quot;2019-05-09&quot;,&quot;date_max&quot;:&quot;2019-05-09&quot;,&quot;hour_min&quot;:null,&quot;hour_max&quot;:null,&quot;altitude_min&quot;:null,&quot;altitude_max&quot;:null,&quot;meta_device_entry&quot;:&quot;web&quot;,&quot;comment&quot;:null,&quot;id_nomenclature_obs_technique&quot;:316,&quot;observers&quot;:[1],&quot;observers_txt&quot;:null,&quot;id_nomenclature_grp_typ&quot;:132,
        &quot;t_occurrences_occtax&quot;:[{
            &quot;id_releve_occtax&quot;:null,&quot;id_occurrence_occtax&quot;:null,&quot;id_nomenclature_obs_meth&quot;:41,&quot;id_nomenclature_bio_condition&quot;:157,&quot;id_nomenclature_bio_status&quot;:29,&quot;id_nomenclature_naturalness&quot;:160,&quot;id_nomenclature_exist_proof&quot;:81,&quot;id_nomenclature_observation_status&quot;:88,&quot;id_nomenclature_blurring&quot;:175,&quot;id_nomenclature_source_status&quot;:75,&quot;determiner&quot;:null,&quot;id_nomenclature_determination_method&quot;:445,&quot;cd_nom&quot;:67111,&quot;nom_cite&quot;:&quot;Ablette =  &lt;i&gt; Alburnus alburnus (Linnaeus, 1758)&lt;/i&gt; - [ES - 67111]&quot;,&quot;meta_v_taxref&quot;:null,&quot;sample_number_proof&quot;:null,&quot;comment&quot;:null,
        &quot;cor_counting_occtax&quot;:[{
            &quot;id_counting_occtax&quot;:null,&quot;id_nomenclature_life_stage&quot;:1,&quot;id_nomenclature_sex&quot;:171,&quot;id_nomenclature_obj_count&quot;:146,&quot;id_nomenclature_type_count&quot;:94,&quot;id_occurrence_occtax&quot;:null,&quot;count_min&quot;:1,&quot;count_max&quot;:1   
            }]    
        }]
    }
}
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">GeoJson&lt;TRelevesOccurrence&gt;</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--occtax-export">
<code class="descname">GET </code><code class="descname">/occtax/export</code><a class="headerlink" href="#get--occtax-export" title="Permalink to this definition">¶</a></dt>
<dd><p>Export data from pr_occtax.export_occtax_sinp view (parameter)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>format</strong> (<em>str</em>) – format of the export (‘csv’, ‘geojson’, ‘shapefile’)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--users-organisms_dataset_actor">
<code class="descname">GET </code><code class="descname">/users/organisms_dataset_actor</code><a class="headerlink" href="#get--users-organisms_dataset_actor" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all organisms and the JDD where there are actor and where 
the current user hase autorization with its cruved
.. :quickref: User;</p>
</dd></dl>

<dl class="get">
<dt id="get--users-organisms">
<code class="descname">GET </code><code class="descname">/users/organisms</code><a class="headerlink" href="#get--users-organisms" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all organisms
.. :quickref: User;</p>
</dd></dl>

<dl class="post">
<dt id="post--users-cor_role">
<code class="descname">POST </code><code class="descname">/users/cor_role</code><a class="headerlink" href="#post--users-cor_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a user in a group
.. :quickref: User;
:param id_role: the id user
:type id_role: int    
:param id_group: the id group
:type id_group: int</p>
<blockquote>
<div># TODO ajouter test sur les POST de données</div></blockquote>
</dd></dl>

<dl class="post">
<dt id="post--users-organism">
<code class="descname">POST </code><code class="descname">/users/organism</code><a class="headerlink" href="#post--users-organism" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert a organism
.. :quickref: User;</p>
</dd></dl>

<dl class="get">
<dt id="get--users-roles">
<code class="descname">GET </code><code class="descname">/users/roles</code><a class="headerlink" href="#get--users-roles" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all roles
.. :quickref: User;</p>
</dd></dl>

<dl class="post">
<dt id="post--users-role">
<code class="descname">POST </code><code class="descname">/users/role</code><a class="headerlink" href="#post--users-role" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert un role
.. :quickref: User;
&#64;TODO : Ne devrait pas être là mais dans UserHub
Utilisé dans l’authentification du CAS INPN</p>
</dd></dl>

<dl class="get">
<dt id="get--meta-acquisition_frameworks">
<code class="descname">GET </code><code class="descname">/meta/acquisition_frameworks</code><a class="headerlink" href="#get--meta-acquisition_frameworks" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all AF with cruved filter
.. :quickref: Metadata;</p>
</dd></dl>

<dl class="post">
<dt id="post--meta-acquisition_framework">
<code class="descname">POST </code><code class="descname">/meta/acquisition_framework</code><a class="headerlink" href="#post--meta-acquisition_framework" title="Permalink to this definition">¶</a></dt>
<dd><p>Post a dataset
.. :quickref: Metadata;</p>
</dd></dl>

<dl class="get">
<dt id="get--meta-datasets">
<code class="descname">GET </code><code class="descname">/meta/datasets</code><a class="headerlink" href="#get--meta-datasets" title="Permalink to this definition">¶</a></dt>
<dd><p>Get datasets list
.. :quickref: Metadata;
:param info_role: add with kwargs
:type info_role: TRole
:query boolean active: filter on active fiel
:query int id_acquisition_framework: get only dataset of given AF
:returns:  <cite>dict{‘data’:list&lt;TDatasets&gt;, ‘with_erros’: &lt;boolean&gt;}</cite></p>
</dd></dl>

<dl class="post">
<dt id="post--meta-dataset">
<code class="descname">POST </code><code class="descname">/meta/dataset</code><a class="headerlink" href="#post--meta-dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Post a dataset
.. :quickref: Metadata;</p>
</dd></dl>

<dl class="get">
<dt id="get--geo-municipalities">
<code class="descname">GET </code><code class="descname">/geo/municipalities</code><a class="headerlink" href="#get--geo-municipalities" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the municipalities
.. :quickref: Ref Geo;</p>
</dd></dl>

<dl class="post">
<dt id="post--geo-areas">
<code class="descname">POST </code><code class="descname">/geo/areas</code><a class="headerlink" href="#post--geo-areas" title="Permalink to this definition">¶</a></dt>
<dd><p>From a posted geojson, the route return all the area intersected
from l_areas
.. :quickref: Ref Geo;</p>
</dd></dl>

<dl class="get">
<dt id="get--geo-areas">
<code class="descname">GET </code><code class="descname">/geo/areas</code><a class="headerlink" href="#get--geo-areas" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the areas of ref_geo.l_areas without geometry
.. :quickref: Ref Geo;</p>
</dd></dl>

<dl class="post">
<dt id="post--geo-info">
<code class="descname">POST </code><code class="descname">/geo/info</code><a class="headerlink" href="#post--geo-info" title="Permalink to this definition">¶</a></dt>
<dd><p>From a posted geojson, the route return the municipalities intersected
and the altitude min/max
.. :quickref: Ref Geo;</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese">
<code class="descname">GET </code><code class="descname">/synthese</code><a class="headerlink" href="#get--synthese" title="Permalink to this definition">¶</a></dt>
<dd><p>Return synthese row(s) filtered by form params NOT USE ANY MORE FOR PERFORMANCE ISSUES
.. :quickref: Synthese;
Params must have same synthese fields names</p>
</dd></dl>

<dl class="get">
<dt id="get--config">
<code class="descname">GET </code><code class="descname">/config</code><a class="headerlink" href="#get--config" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse and return configuration files as toml 
.. :quickref: Generic;</p>
</dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-other_permissions_form-id_permission-(int-id_permission)-user-(int-id_role)-filter_type-(int-id_filter_type)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/other_permissions_form/id_permission/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_permission</em><span class="sig-paren">)</span><code class="descname">/user/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><code class="descname">/filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-other_permissions_form-id_permission-(int-id_permission)-user-(int-id_role)-filter_type-(int-id_filter_type)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-other_permissions_form-user-(int-id_role)-filter_type-(int-id_filter_type)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/other_permissions_form/user/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><code class="descname">/filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-other_permissions_form-user-(int-id_role)-filter_type-(int-id_filter_type)" title="Permalink to this definition">¶</a></dt>
<dd><p>Form to define permisisons for a user expect SCOPE permissions
.. :quickref: View_Permission;</p>
</dd></dl>

<dl class="post">
<dt id="post--permissions_backoffice-other_permissions_form-id_permission-(int-id_permission)-user-(int-id_role)-filter_type-(int-id_filter_type)">
<code class="descname">POST </code><code class="descname">/permissions_backoffice/other_permissions_form/id_permission/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_permission</em><span class="sig-paren">)</span><code class="descname">/user/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><code class="descname">/filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><a class="headerlink" href="#post--permissions_backoffice-other_permissions_form-id_permission-(int-id_permission)-user-(int-id_role)-filter_type-(int-id_filter_type)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="post">
<dt id="post--permissions_backoffice-other_permissions_form-user-(int-id_role)-filter_type-(int-id_filter_type)">
<code class="descname">POST </code><code class="descname">/permissions_backoffice/other_permissions_form/user/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><code class="descname">/filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><a class="headerlink" href="#post--permissions_backoffice-other_permissions_form-user-(int-id_role)-filter_type-(int-id_filter_type)" title="Permalink to this definition">¶</a></dt>
<dd><p>Form to define permisisons for a user expect SCOPE permissions
.. :quickref: View_Permission;</p>
</dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)-object-(int-id_object)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/cruved_form/module/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_module</em><span class="sig-paren">)</span><code class="descname">/role/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><code class="descname">/object/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_object</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)-object-(int-id_object)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/cruved_form/module/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_module</em><span class="sig-paren">)</span><code class="descname">/role/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="post">
<dt id="post--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)-object-(int-id_object)">
<code class="descname">POST </code><code class="descname">/permissions_backoffice/cruved_form/module/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_module</em><span class="sig-paren">)</span><code class="descname">/role/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><code class="descname">/object/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_object</em><span class="sig-paren">)</span><a class="headerlink" href="#post--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)-object-(int-id_object)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="post">
<dt id="post--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)">
<code class="descname">POST </code><code class="descname">/permissions_backoffice/cruved_form/module/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_module</em><span class="sig-paren">)</span><code class="descname">/role/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><a class="headerlink" href="#post--permissions_backoffice-cruved_form-module-(int-id_module)-role-(int-id_role)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)-id_filter-(int-id_filter)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/filter_form/id_filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><code class="descname">/id_filter/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)-id_filter-(int-id_filter)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/filter_form/id_filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="post">
<dt id="post--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)-id_filter-(int-id_filter)">
<code class="descname">POST </code><code class="descname">/permissions_backoffice/filter_form/id_filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><code class="descname">/id_filter/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter</em><span class="sig-paren">)</span><a class="headerlink" href="#post--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)-id_filter-(int-id_filter)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="post">
<dt id="post--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)">
<code class="descname">POST </code><code class="descname">/permissions_backoffice/filter_form/id_filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><a class="headerlink" href="#post--permissions_backoffice-filter_form-id_filter_type-(int-id_filter_type)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-filter_list-id_filter_type-(int-id_filter_type)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/filter_list/id_filter_type/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_filter_type</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-filter_list-id_filter_type-(int-id_filter_type)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="get">
<dt id="get--nomenclatures-admin-static-(path-filename)">
<code class="descname">GET </code><code class="descname">/nomenclatures/admin/static/</code><span class="sig-paren">(</span><em class="property">path: </em><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#get--nomenclatures-admin-static-(path-filename)" title="Permalink to this definition">¶</a></dt>
<dd><p>Function used internally to send static files from the static
folder to the browser.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.5.</span></p>
</div>
</dd></dl>

<dl class="delete">
<dt id="delete--occtax-releve-occurrence_counting-(int-id_count)">
<code class="descname">DELETE </code><code class="descname">/occtax/releve/occurrence_counting/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_count</em><span class="sig-paren">)</span><a class="headerlink" href="#delete--occtax-releve-occurrence_counting-(int-id_count)" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete one counting</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params int id_count:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">ID of the counting to delete</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="delete">
<dt id="delete--occtax-releve-occurrence-(int-id_occ)">
<code class="descname">DELETE </code><code class="descname">/occtax/releve/occurrence/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_occ</em><span class="sig-paren">)</span><a class="headerlink" href="#delete--occtax-releve-occurrence-(int-id_occ)" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete one occurrence and associated counting</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params int id_occ:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">ID of the occurrence to delete</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-user_other_permissions-(id_role)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/user_other_permissions/</code><span class="sig-paren">(</span><em>id_role</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-user_other_permissions-(id_role)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all the permissions define for a user expect SCOPE permissions</p>
</dd></dl>

<dl class="get">
<dt id="get--permissions_backoffice-user_cruved-(id_role)">
<code class="descname">GET </code><code class="descname">/permissions_backoffice/user_cruved/</code><span class="sig-paren">(</span><em>id_role</em><span class="sig-paren">)</span><a class="headerlink" href="#get--permissions_backoffice-user_cruved-(id_role)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all scope CRUVED (with heritage) for a user in all modules</p>
</dd></dl>

<dl class="post">
<dt id="post--permissions_backoffice-filter-(id_filter)">
<code class="descname">POST </code><code class="descname">/permissions_backoffice/filter/</code><span class="sig-paren">(</span><em>id_filter</em><span class="sig-paren">)</span><a class="headerlink" href="#post--permissions_backoffice-filter-(id_filter)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="get">
<dt id="get--nomenclatures-nomenclature-(int-id_type)">
<code class="descname">GET </code><code class="descname">/nomenclatures/nomenclature/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_type</em><span class="sig-paren">)</span><a class="headerlink" href="#get--nomenclatures-nomenclature-(int-id_type)" title="Permalink to this definition">¶</a></dt>
<dd><p>=&gt; Déprécié pour des raisons de volatilité des identifiants en BD</p>
<blockquote>
<div><dl class="docutils">
<dt>Route <span class="classifier-delimiter">:</span> <span class="classifier">liste des termes d’une nomenclature</span></dt>
<dd>basées sur les identifiants de nomenclature</dd>
</dl>
<p>Possibilité de filtrer par regne et group2Inpn</p>
</div></blockquote>
</dd></dl>

<dl class="get">
<dt id="get--nomenclatures-nomenclature-(string-code_type)">
<code class="descname">GET </code><code class="descname">/nomenclatures/nomenclature/</code><span class="sig-paren">(</span><em class="property">string: </em><em>code_type</em><span class="sig-paren">)</span><a class="headerlink" href="#get--nomenclatures-nomenclature-(string-code_type)" title="Permalink to this definition">¶</a></dt>
<dd><p>Route : liste des termes d’une nomenclature
basées sur le code mnemonique du type de nomenclature
Possibilité de filtrer par regne et group2Inpn</p>
</dd></dl>

<dl class="get">
<dt id="get--gn_monitoring-siteslist-(int-id_site)">
<code class="descname">GET </code><code class="descname">/gn_monitoring/siteslist/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_site</em><span class="sig-paren">)</span><a class="headerlink" href="#get--gn_monitoring-siteslist-(int-id_site)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get minimal information for a site {id_base_site, nom site}
.. :quickref: Monitoring;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>id_site</strong> – id of base site</li>
<li><strong>type</strong> – int</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--gn_monitoring-siteareas-(int-id_site)">
<code class="descname">GET </code><code class="descname">/gn_monitoring/siteareas/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_site</em><span class="sig-paren">)</span><a class="headerlink" href="#get--gn_monitoring-siteareas-(int-id_site)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get areas of a site from cor_site_area as geojson
.. :quickref: Monitoring;
:param id_module: int
:type id_module: int
:param id_area_type:
:type id_area_type: int</p>
</dd></dl>

<dl class="get">
<dt id="get--gn_commons-media-(int-id_media)">
<code class="descname">GET </code><code class="descname">/gn_commons/media/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_media</em><span class="sig-paren">)</span><a class="headerlink" href="#get--gn_commons-media-(int-id_media)" title="Permalink to this definition">¶</a></dt>
<dd><p>Retourne un media
.. :quickref: Commons;</p>
</dd></dl>

<dl class="delete">
<dt id="delete--gn_commons-media-(int-id_media)">
<code class="descname">DELETE </code><code class="descname">/gn_commons/media/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_media</em><span class="sig-paren">)</span><a class="headerlink" href="#delete--gn_commons-media-(int-id_media)" title="Permalink to this definition">¶</a></dt>
<dd><p>Suppression d’un media</p>
</dd></dl>

<dl class="get">
<dt id="get--synthese-vsynthese-(id_synthese)">
<code class="descname">GET </code><code class="descname">/synthese/vsynthese/</code><span class="sig-paren">(</span><em>id_synthese</em><span class="sig-paren">)</span><a class="headerlink" href="#get--synthese-vsynthese-(id_synthese)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one synthese record for web app with all decoded nomenclature
.. :quickref: Synthese;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params id_synthese:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--occtax-counting-(int-id_counting)">
<code class="descname">GET </code><code class="descname">/occtax/counting/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_counting</em><span class="sig-paren">)</span><a class="headerlink" href="#get--occtax-counting-(int-id_counting)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one counting record, with its id_counting</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>id_counting</strong> (<em>int</em>) – the pr_occtax.cor_counting_occtax PK</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a dict representing a counting record</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Rtype:</th><td class="field-body"><p class="first last">dict&lt;CorCountingOccurrence&gt;</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--occtax-releve-(int-id_releve)">
<code class="descname">GET </code><code class="descname">/occtax/releve/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_releve</em><span class="sig-paren">)</span><a class="headerlink" href="#get--occtax-releve-(int-id_releve)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one releve</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>id_releve</strong> (<em>int</em>) – the id releve from pr_occtax.t_releve_occtax</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Return a releve with its attached Cruved</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Rtype:</th><td class="field-body"><p class="first last"><cite>dict{‘releve’:&lt;TRelevesOccurrence&gt;, ‘cruved’: Cruved}</cite></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="delete">
<dt id="delete--occtax-releve-(int-id_releve)">
<code class="descname">DELETE </code><code class="descname">/occtax/releve/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_releve</em><span class="sig-paren">)</span><a class="headerlink" href="#delete--occtax-releve-(int-id_releve)" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete one releve and its associated occurrences and counting</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Params int id_releve:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">ID of the releve to delete</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--users-menu-(int-id_menu)">
<code class="descname">GET </code><code class="descname">/users/menu/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_menu</em><span class="sig-paren">)</span><a class="headerlink" href="#get--users-menu-(int-id_menu)" title="Permalink to this definition">¶</a></dt>
<dd><p>Retourne la liste des roles associés à un menu
.. :quickref: User;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>id_menu</strong> (<em>int</em>) – the id of user list (utilisateurs.bib_list)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Query Parameters:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body"><ul class="first last simple">
<li><strong>nom_complet</strong> (<em>str</em>) – begenning of complet name of the role</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="get">
<dt id="get--users-role-(int-id_role)">
<code class="descname">GET </code><code class="descname">/users/role/</code><span class="sig-paren">(</span><em class="property">int: </em><em>id_role</em><span class="sig-paren">)</span><a class="headerlink" href="#get--users-role-(int-id_role)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get role detail
.. :quickref: User;
:param id_role: the id user
:type id_role: int</p>
</dd></dl>

<dl class="post">
<dt id="post--meta-aquisition_framework_mtd-(uuid_af)">
<code class="descname">POST </code><code class="descname">/meta/aquisition_framework_mtd/</code><span class="sig-paren">(</span><em>uuid_af</em><span class="sig-paren">)</span><a class="headerlink" href="#post--meta-aquisition_framework_mtd-(uuid_af)" title="Permalink to this definition">¶</a></dt>
<dd><p>Post an acquisition framwork from MTD web service in XML
.. :quickref: Metadata;</p>
</dd></dl>

<dl class="get">
<dt id="get--meta-acquisition_framework-(id_acquisition_framework)">
<code class="descname">GET </code><code class="descname">/meta/acquisition_framework/</code><span class="sig-paren">(</span><em>id_acquisition_framework</em><span class="sig-paren">)</span><a class="headerlink" href="#get--meta-acquisition_framework-(id_acquisition_framework)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get on AF
.. :quickref: Metadata;
:param id_acquisition_framework: the id_acquisition_framework
:param type: int</p>
</dd></dl>

<dl class="post">
<dt id="post--meta-dataset_mtd-(id_user)-(id_organism)">
<code class="descname">POST </code><code class="descname">/meta/dataset_mtd/</code><span class="sig-paren">(</span><em>id_user</em><span class="sig-paren">)</span><code class="descname">/</code><span class="sig-paren">(</span><em>id_organism</em><span class="sig-paren">)</span><a class="headerlink" href="#post--meta-dataset_mtd-(id_user)-(id_organism)" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="post">
<dt id="post--meta-dataset_mtd-(id_user)">
<code class="descname">POST </code><code class="descname">/meta/dataset_mtd/</code><span class="sig-paren">(</span><em>id_user</em><span class="sig-paren">)</span><a class="headerlink" href="#post--meta-dataset_mtd-(id_user)" title="Permalink to this definition">¶</a></dt>
<dd><p>Post a jdd from the mtd XML
.. :quickref: Metadata;</p>
</dd></dl>

<dl class="get">
<dt id="get--meta-dataset-(id_dataset)">
<code class="descname">GET </code><code class="descname">/meta/dataset/</code><span class="sig-paren">(</span><em>id_dataset</em><span class="sig-paren">)</span><a class="headerlink" href="#get--meta-dataset-(id_dataset)" title="Permalink to this definition">¶</a></dt>
<dd><p>Get one dataset
.. :quickref: Metadata;
:param id_dataset: the id_dataset
:param type: int
:returns: dict&lt;TDataset&gt;</p>
</dd></dl>

<dl class="get">
<dt id="get--genericview-(view_schema)-(view_name)">
<code class="descname">GET </code><code class="descname">/genericview/</code><span class="sig-paren">(</span><em>view_schema</em><span class="sig-paren">)</span><code class="descname">/</code><span class="sig-paren">(</span><em>view_name</em><span class="sig-paren">)</span><a class="headerlink" href="#get--genericview-(view_schema)-(view_name)" title="Permalink to this definition">¶</a></dt>
<dd><p>Service générique permettant de requeter une vue
.. :quickref: Generic;</p>
<p>limit : nombre limit de résultats à retourner
offset : numéro de page
geometry_field : nom de la colonne contenant la géométrie</p>
<blockquote>
<div>Si elle est spécifiée les données seront retournés en geojson</div></blockquote>
<dl class="docutils">
<dt>FILTRES :</dt>
<dd><dl class="first last docutils">
<dt>nom_col=val: Si nom_col fait partie des colonnes</dt>
<dd>de la vue alors filtre nom_col=val</dd>
<dt>ilikenom_col=val: Si nom_col fait partie des colonnes</dt>
<dd>de la vue et que la colonne est de type texte
alors filtre nom_col ilike ‘%val%’</dd>
<dt>filter_d_up_nom_col=val: Si nom_col fait partie des colonnes</dt>
<dd>de la vue et que la colonne est de type date
alors filtre nom_col &gt;= val</dd>
<dt>filter_d_lo_nom_col=val: Si nom_col fait partie des colonnes</dt>
<dd>de la vue et que la colonne est de type date
alors filtre nom_col &lt;= val</dd>
<dt>filter_d_eq_nom_col=val: Si nom_col fait partie des colonnes</dt>
<dd>de la vue et que la colonne est de type date
alors filtre nom_col == val</dd>
<dt>filter_n_up_nom_col=val: Si nom_col fait partie des colonnes</dt>
<dd>de la vue et que la colonne est de type numérique
alors filtre nom_col &gt;= val</dd>
<dt>filter_n_lo_nom_col=val: Si nom_col fait partie des colonnes</dt>
<dd>de la vue et que la colonne est de type numérique
alors filtre nom_col &lt;= val</dd>
</dl>
</dd>
<dt>ORDONNANCEMENT :</dt>
<dd><dl class="first last docutils">
<dt>orderby: char</dt>
<dd>Nom du champ sur lequel baser l’ordonnancement</dd>
<dt>order: char (asc|desc)</dt>
<dd>Sens de l’ordonnancement</dd>
</dl>
</dd>
</dl>
<p>json
{</p>
<blockquote>
<div>‘total’: Nombre total de résultat,
‘total_filtered’: Nombre total de résultat après filtration,
‘page’: Numéro de la page retournée,
‘limit’: Nombre de résultats,
‘items’: données au format Json ou GeoJson</div></blockquote>
<p>}</p>
<blockquote>
<div>order by : &#64;TODO</div></blockquote>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="developpement-frontend">
<h2>Développement Frontend<a class="headerlink" href="#developpement-frontend" title="Permalink to this headline">¶</a></h2>
<div class="section" id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h3>
<p>Bonnes pratiques :</p>
<p>Chaque gn_module de GeoNature doit être un module Angular indépendant <a class="reference external" href="https://angular.io/guide/ngmodule">https://angular.io/guide/ngmodule</a>.</p>
<p>Ce gn_module peut s’appuyer sur une série de composants génériques intégrés dans le module GN2CommonModule et réutilisables dans n’importe quel module.</p>
</div>
</div>
<div class="section" id="les-composants-generiques">
<h2><strong>Les composants génériques</strong><a class="headerlink" href="#les-composants-generiques" title="Permalink to this headline">¶</a></h2>
<p>Un ensemble de composants décrits ci-dessous sont intégrés dans le coeur de GeoNature et permettent aux développeurs de simplifier la mise en place de formulaires ou de bloc cartographiques.</p>
<p>Une documentation complète des composants générique est <a class="reference external" href="http://pnx-si.github.io/GeoNature/frontend/modules/GN2CommonModule.html">disponible ici</a></p>
<p>NB: mes composants de type “formulaire” (balise <cite>input</cite> ou <cite>select</cite>) partagent une logique commune et ont des <code class="docutils literal"><span class="pre">Inputs</span></code> et des <code class="docutils literal"><span class="pre">Outputs</span></code> communs décrit ci dessous. (voir <a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/frontend/src/app/GN2CommonModule/form/genericForm.component.ts">https://github.com/PnX-SI/GeoNature/blob/develop/frontend/src/app/GN2CommonModule/form/genericForm.component.ts</a>).</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Inputs</dt>
<dd><ul class="first last">
<li>L’input <code class="docutils literal"><span class="pre">parentFormControl</span></code> de type <code class="docutils literal"><span class="pre">FormControl</span></code> (<a class="reference external" href="https://angular.io/api/forms/FormControl">https://angular.io/api/forms/FormControl</a>) permet de contrôler la logique et les valeurs du formulaire depuis l’extérieur du composant. Cet input est <strong>obligatoire</strong> pour le fonctionnement du composant.</li>
<li>L’input <code class="docutils literal"><span class="pre">label</span></code> (string) permet d’afficher un label au dessus de l’input.</li>
<li>L’input <code class="docutils literal"><span class="pre">displayAll</span></code> (boolean, défaut = false) permet d’ajouter un item ‘tous’ sur les inputs de type select (Exemple: pour selectionner tous les jeux de données de la liste)</li>
<li>L’input <code class="docutils literal"><span class="pre">multiSelect</span></code> (boolean, défaut = false) permet de passer les composants de type select en “multiselect” (sélection multiple sur une liste déroulante). Le parentFormControl devient par conséquent un tableau</li>
<li>L’input <code class="docutils literal"><span class="pre">searchBar</span></code> (boolean, défaut = false) permet de rajouter une barre de recherche sur les composants multiselect</li>
<li>L’input <code class="docutils literal"><span class="pre">disabled</span></code> (boolean) permet de rendre le composant non-saisissable</li>
<li>L’input <code class="docutils literal"><span class="pre">debounceTime</span></code> définit une durée en ms après laquelle les évenements <code class="docutils literal"><span class="pre">onChange</span></code> et <code class="docutils literal"><span class="pre">onDelete</span></code> sont déclenchés suite à un changement d’un formulaire. (Par défault à 0)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Outputs</dt>
<dd>Plusieurs <code class="docutils literal"><span class="pre">Output</span></code> communs à ses composants permettent d’émettre des événements liés aux formulaires.<ul class="last">
<li><code class="docutils literal"><span class="pre">onChange</span></code> : événement émit à chaque fois qu’un changement est effectué sur le composant. Renvoie la valeur fraiche de l’input.</li>
<li><code class="docutils literal"><span class="pre">onDelete</span></code> : événement émit chaque fois que le champ du formulaire est supprimé. Renvoie un évenement vide.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Ces composants peuvent être considérés comme des “dump components” ou “presentation components”, puisque que la logique de contrôle est déporté au composant parent qui l’accueil (<a class="reference external" href="https://blog.angular-university.io/angular-2-smart-components-vs-presentation-components-whats-the-difference-when-to-use-each-and-why/">https://blog.angular-university.io/angular-2-smart-components-vs-presentation-components-whats-the-difference-when-to-use-each-and-why/</a>)</p>
<p>Un ensemble de composant permattant de simplifier l’affichage des cartographies leaflet sont disponible. Notamment un composant “map-list” permettant de connecter une carte avec une liste d’objet décrit en détail ci dessous.</p>
<ul>
<li><dl class="first docutils">
<dt><strong>MapListComponent</strong></dt>
<dd><p class="first">Le composant MapList fournit une carte pouvant être synchronisé avec une liste. La liste, pouvant être spécifique à chaque module, elle n’est pas intégré dans le composant et est laissé à la responsabilité du développeur. Le service <code class="docutils literal"><span class="pre">MapListService</span></code> offre cependant des fonctions permettant facilement de synchroniser les deux éléments.</p>
<p>Fonctionnalité et comportement offert par le le composant et le service:</p>
<ul>
<li><dl class="first docutils">
<dt>Charger les données</dt>
<dd><p class="first">Le service expose la fonction <code class="docutils literal"><span class="pre">getData(apiEndPoint,</span> <span class="pre">params?)</span></code> permettant de charger les données pour la carte et la liste. Cette fonction doit être utilisée dans le composant qui utilise le composant <code class="docutils literal"><span class="pre">MapListComponent</span></code>. Elle se charge de faire appel à l’API passé en paramètre et de rendre les données disponibles au service.
Le deuxième paramètre <code class="docutils literal"><span class="pre">params</span></code> est un tableau de paramètre(s) (facultatif). Il permet de filtrer les données sur n’importe quelle propriété du GeoJson, et également de gérer la pagination.</p>
<p>Exemple: afficher les 10 premiers relevés du cd_nom 212 :</p>
<p><code class="docutils literal"><span class="pre">mapListService.getData('occtax/releve',</span> <span class="pre">[{'param':</span> <span class="pre">'limit',</span> <span class="pre">'value':</span> <span class="pre">10'},{'param':</span> <span class="pre">'cd_nom',</span> <span class="pre">'value':</span> <span class="pre">212'}])</span></code></p>
<p><a class="reference external" href="https://github.com/PnX-SI/GeoNature/blob/develop/frontend/src/modules/occtax/occtax-map-list/occtax-map-list.component.ts#L84/">Exemple dans le module OccTax</a></p>
<p>L’API doit necessairement renvoyer un objet comportant un GeoJson. La structure du l’objet doit être la suivante :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">nombre</span> <span class="n">d</span><span class="s1">&#39;élément total,</span>
<span class="s1">&#39;total_filtered&#39;</span><span class="p">:</span> <span class="n">nombre</span> <span class="n">d</span><span class="s1">&#39;élément filtré,</span>
<span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">numéro</span> <span class="n">de</span> <span class="n">page</span> <span class="n">de</span> <span class="n">la</span> <span class="n">liste</span><span class="p">,</span>
<span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limite</span> <span class="n">d</span><span class="s1">&#39;élément renvoyé,</span>
<span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="n">le</span> <span class="n">GeoJson</span>
</pre></div>
</div>
<p class="last">Pour un liste simple sans pagination, seule la propriété ‘items’ est obligatoire.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Rafraichir les données</dt>
<dd><p class="first">La fonction <code class="docutils literal"><span class="pre">refreshData(apiEndPoint,</span> <span class="pre">method,</span> <span class="pre">params?)</span></code> permet de raffrachir les données en fonction de filtres personnalisés.
Les paramètres <code class="docutils literal"><span class="pre">apiEndPoint</span></code>&nbsp;et <code class="docutils literal"><span class="pre">params</span></code> sont les mêmes que pour la fonction <code class="docutils literal"><span class="pre">getData</span></code>. Le paramètre <code class="docutils literal"><span class="pre">method</span></code> permet lui de chosir si on ajoute - <code class="docutils literal"><span class="pre">append</span></code>- , ou si on initialise (ou remplace) -<code class="docutils literal"><span class="pre">set</span></code>- un filtre.</p>
<p>Exemple 1 : Pour filtrer sur l’observateur 1, puis ajouter un filtre sur l’observateur 2.</p>
<p><code class="docutils literal"><span class="pre">mapListService.refreshData('occtax/relevé',</span> <span class="pre">'append,</span> <span class="pre">[{'param':</span> <span class="pre">'observers',</span> <span class="pre">'value':</span> <span class="pre">1'}])</span></code></p>
<p>puis</p>
<p><code class="docutils literal"><span class="pre">refreshData('occtax/relevé',</span> <span class="pre">'append,</span> <span class="pre">[{'param':</span> <span class="pre">'observers',</span> <span class="pre">'value':</span> <span class="pre">2'}])</span></code></p>
<p>Exemple 2: pour filtrer sur le cd_nom 212, supprimer ce filtre et filtrer sur  le cd_nom 214</p>
<p><code class="docutils literal"><span class="pre">mapListService.refreshData('occtax/relevé',</span> <span class="pre">'set,</span> <span class="pre">[{'param':</span> <span class="pre">'cd_nom',</span> <span class="pre">'value':</span> <span class="pre">1'}])</span></code></p>
<p>puis</p>
<p class="last"><code class="docutils literal"><span class="pre">mapListService.refreshData('occtax/relevé',</span> <span class="pre">'set,</span> <span class="pre">[{'param':</span> <span class="pre">'cd_nom',</span> <span class="pre">'value':</span> <span class="pre">2'}])</span></code></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Gestion des évenements:</dt>
<dd><ul class="first last simple">
<li>Au clic sur un marker de la carte, le service <code class="docutils literal"><span class="pre">MapListService</span></code> expose la propriété <code class="docutils literal"><span class="pre">selectedRow</span></code> qui est un tableau contenant l’id du marker sélectionné. Il est ainsi possible de surligner l’élément séléctionné dans le liste.</li>
<li>Au clic sur une ligne du tableau, utiliser la fonction <code class="docutils literal"><span class="pre">MapListService.onRowSelected(id)</span></code> (id étant l’id utilisé dans le GeoJson) qui permet de zoomer sur le point séléctionner et de changer la couleur de celui-ci.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>La service contient également deux propriétés publiques <code class="docutils literal"><span class="pre">geoJsonData</span></code> (le geojson renvoyé par l’API) et <code class="docutils literal"><span class="pre">tableData</span></code> &nbsp;(le tableau de features du Geojson) qui sont respectivement passées à la carte et à la liste. Ces deux propriétés sont utilisables pour intéragir (ajouter, supprimer) avec les données de la carte et de la liste.</p>
<p><strong>Selector</strong>: <code class="docutils literal"><span class="pre">pnx-map-list</span></code></p>
<p><strong>Inputs</strong>:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name"><code class="docutils literal"><span class="pre">idName</span></code>:</th><td class="field-body"><p class="first">Libellé de l’id du geojson (id_releve, id)</p>
<p>Type: <code class="docutils literal"><span class="pre">string</span></code></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name"><code class="docutils literal"><span class="pre">height</span></code>:</th><td class="field-body"><p class="first">Taille de l’affichage de la carte leaflet</p>
<p class="last">Type: <code class="docutils literal"><span class="pre">string</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>Exemple d’utilisation avec une liste simple:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pnx</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="nb">list</span>
        <span class="n">idName</span><span class="o">=</span><span class="s2">&quot;id_releve_occtax&quot;</span>
        <span class="n">height</span><span class="o">=</span><span class="s2">&quot;80vh&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">pnx</span><span class="o">-</span><span class="nb">map</span><span class="o">-</span><span class="nb">list</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">tr</span> <span class="n">ngFor</span><span class="o">=</span><span class="s2">&quot;let row of mapListService.tableData&quot;</span> <span class="p">[</span><span class="n">ngClass</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot; {&#39;selected&#39;: mapListService.selectedRow[0]} == row.id &quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">td</span> <span class="p">(</span><span class="n">click</span><span class="p">)</span><span class="o">=</span><span class="s2">&quot;mapListService.onRowSelect(row.id)&quot;</span><span class="o">&gt;</span> <span class="n">Zoom</span> <span class="n">on</span> <span class="nb">map</span> <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">td</span> <span class="o">&gt;</span> <span class="p">{{</span><span class="n">row</span><span class="o">.</span><span class="n">observers</span><span class="p">}}</span> <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">td</span> <span class="o">&gt;</span> <span class="p">{{</span><span class="n">row</span><span class="o">.</span><span class="n">date</span><span class="p">}}</span> <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="outils-d-aide-a-la-qualite-du-code">
<h2>Outils d’aide à la qualité du code<a class="headerlink" href="#outils-d-aide-a-la-qualite-du-code" title="Permalink to this headline">¶</a></h2>
<p>Des outils d’amélioration du code pour les développeurs peuvent être utilisés : flake8, pylint, mypy, pytest, coverage.</p>
<p>La documentation peut être générée avec Sphinx.</p>
<p>Les fichiers de configuration de ces outils se trouvent à la racine du projet :</p>
<ul class="simple">
<li>.flake8</li>
<li>.pylint</li>
<li>.mypy</li>
<li>.pytest</li>
<li>.coverage</li>
</ul>
<p>Un fichier <code class="docutils literal"><span class="pre">.editorconfig</span></code> permettant de définir le comportement de votre éditeur de code
est également disponible à la racine du projet.</p>
<div class="section" id="installation-des-outils">
<h3>Installation des outils<a class="headerlink" href="#installation-des-outils" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">user</span> <span class="n">pipenv</span>
<span class="n">pipenv</span> <span class="n">install</span> <span class="o">--</span><span class="n">dev</span>
</pre></div>
</div>
<p>La documentation de ces outils est disponible en ligne :</p>
<ul class="simple">
<li><a class="reference external" href="http://flake8.pycqa.org/en/latest/">http://flake8.pycqa.org/en/latest/</a></li>
<li><a class="reference external" href="https://www.pylint.org/">https://www.pylint.org/</a> - Doc : <a class="reference external" href="https://pylint.readthedocs.io/en/latest/">https://pylint.readthedocs.io/en/latest/</a></li>
<li><a class="reference external" href="https://mypy.readthedocs.io/en/latest/">https://mypy.readthedocs.io/en/latest/</a></li>
<li><a class="reference external" href="https://docs.pytest.org/en/latest/contents.html">https://docs.pytest.org/en/latest/contents.html</a></li>
<li><a class="reference external" href="https://coverage.readthedocs.io/en/coverage-4.4.2/">https://coverage.readthedocs.io/en/coverage-4.4.2/</a></li>
<li><a class="reference external" href="http://www.sphinx-doc.org/en/stable/">http://www.sphinx-doc.org/en/stable/</a> -  Doc : <a class="reference external" href="http://www.sphinx-doc.org/en/stable/contents.html">http://www.sphinx-doc.org/en/stable/contents.html</a></li>
</ul>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>Pour utiliser ces outils il faut se placer dans le virtualenv</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pipenv</span> <span class="n">shell</span>
</pre></div>
</div>
</div>
<div class="section" id="sphinx">
<h3>Sphinx<a class="headerlink" href="#sphinx" title="Permalink to this headline">¶</a></h3>
<p>Sphinx est un générateur de documentation.</p>
<p>Pour générer la documentation HTML, se placer dans le répertoire <code class="docutils literal"><span class="pre">docs</span></code> et modifier les fichiers .rst</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">docs</span>
<span class="n">make</span> <span class="n">html</span>
</pre></div>
</div>
</div>
<div class="section" id="flake8">
<h3>Flake8<a class="headerlink" href="#flake8" title="Permalink to this headline">¶</a></h3>
<p>Flake8 inspecte le code et pointe tous les écarts à la norme PEP8. Il recherche également toutes les erreurs syntaxiques et stylistiques courantes.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">backend</span>
<span class="n">flake8</span>
</pre></div>
</div>
</div>
<div class="section" id="pylint">
<h3>Pylint<a class="headerlink" href="#pylint" title="Permalink to this headline">¶</a></h3>
<p>Pylint fait la même chose que Flake8 mais il est plus complet, plus configurable mais aussi plus exigeant.</p>
<p>Pour inspecter le répertoire <code class="docutils literal"><span class="pre">geonature</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">backend</span>
<span class="n">pylint</span> <span class="n">geonature</span>
</pre></div>
</div>
</div>
<div class="section" id="tslint">
<h3>tslint<a class="headerlink" href="#tslint" title="Permalink to this headline">¶</a></h3>
<p>tslint fait la même chose que pylint mais pour la partie frontend en typescript.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">frontend</span>
<span class="n">ng</span> <span class="n">lint</span>
</pre></div>
</div>
</div>
<div class="section" id="mypy">
<h3>Mypy<a class="headerlink" href="#mypy" title="Permalink to this headline">¶</a></h3>
<p>Mypy vérifie les erreurs de typage.
Mypy est utilisé pour l’éditeur de texte en tant que linter.</p>
</div>
<div class="section" id="pytest">
<h3>Pytest<a class="headerlink" href="#pytest" title="Permalink to this headline">¶</a></h3>
<p>Pytest permet de mettre en place des tests fonctionnels et automatisés du code Python.</p>
<p>Les fichiers de test sont dans le répertoire <code class="docutils literal"><span class="pre">backend/tests</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">backend</span>
<span class="n">pytest</span>
</pre></div>
</div>
</div>
<div class="section" id="coverage">
<h3>Coverage<a class="headerlink" href="#coverage" title="Permalink to this headline">¶</a></h3>
<p>Coverage permet de donner une indication concernant la couverture du code par les tests.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">backend</span>
<span class="n">pytest</span> <span class="o">--</span><span class="n">cov</span><span class="o">=</span><span class="n">geonature</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">report</span><span class="o">=</span><span class="n">html</span>
</pre></div>
</div>
<p>Ceci génénère un rapport html disponible dans  <code class="docutils literal"><span class="pre">backend/htmlcov/index.html</span></code>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="versions-compatibility.html" class="btn btn-neutral float-right" title="COMPATIBILITE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="import-level-2.html" class="btn btn-neutral float-left" title="IMPORT NIVEAU 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, PnE, PnC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>